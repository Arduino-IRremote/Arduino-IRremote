<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>IRremote: src/private/IRTimer.hpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">IRremote
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('IRTimer_8hpp_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">IRTimer.hpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="IRTimer_8hpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160; </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#ifndef _IR_TIMER_HPP</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#define _IR_TIMER_HPP</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160; </div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment"> * Functions declared here</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="group__Timer.html#ga41e88e0b7edea76b3c77643ca7a3468f">   47</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga41e88e0b7edea76b3c77643ca7a3468f">timerResetInterruptPending</a>();</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gae0ec21c275dd13fff83445ce6cc900d7">timerEnableReceiveInterrupt</a>();</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>();</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga8cca92581b5452eaac5b3075227c6c56">timerConfigForReceive</a>();</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gac67e6a15f31989aa182389cd4a8729c9">enableSendPWMByTimer</a>();</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga352399811c67be16548d81a18e3cd337">disableSendPWMByTimer</a>();</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gab4f8dc26e10c0481e8859252afa4d42b">timerConfigForSend</a>(uint16_t aFrequencyKHz);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">// SEND_PWM_BY_TIMER is defined in IRremote.hpp line 195.</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#if  defined(SEND_PWM_BY_TIMER) &amp;&amp; ( (defined(ESP32) || defined(ARDUINO_ARCH_RP2040) || defined(PARTICLE)) || defined(ARDUINO_ARCH_MBED) )</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#define SEND_PWM_DOES_NOT_USE_RECEIVE_TIMER // Receive timer and send generation timer are independent here.</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160; </div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#if defined(IR_SEND_PIN) &amp;&amp; defined(SEND_PWM_BY_TIMER) &amp;&amp; !defined(SEND_PWM_DOES_NOT_USE_RECEIVE_TIMER) // For ESP32 etc. IR_SEND_PIN definition is useful</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#undef IR_SEND_PIN // To avoid &quot;warning: &quot;IR_SEND_PIN&quot; redefined&quot;. The user warning is done at IRremote.hpp line 202.</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160; </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">// Macros for enabling timers for development</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">//#define SEND_PWM_BY_TIMER</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">//#define IR_USE_AVR_TIMER1</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">//#define IR_USE_AVR_TIMER2</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">//#define IR_USE_AVR_TIMER3</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">//#define IR_USE_AVR_TIMER4</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">//#define IR_USE_AVR_TIMER4_HS</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">//#define IR_USE_AVR_TIMER5</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">//#define IR_USE_AVR_TIMER_TINY0</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">//#define IR_USE_AVR_TIMER_TINY1</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">//#define IR_USE_AVR_TIMER_A</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">//#define IR_USE_AVR_TIMER_B</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">//#define IR_USE_AVR_TIMER_D</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">//#define __MK20DX128__</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">//#define __MKL26Z64__</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">//#define __IMXRT1062__</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">//#define ESP8266</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">//#define ESP32</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">//#define ARDUINO_ARCH_SAMD</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">//#define ARDUINO_ARCH_MBED</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">//#define ARDUINO_ARCH_RP2040</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">//#define NRF5</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">//#define __STM32F1__</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">//#define STM32F1xx</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">//#define PARTICLE</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">//#define ARDUINO_ARCH_RENESAS</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160; </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="preprocessor">#if defined (DOXYGEN)</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; </div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="preprocessor">#define IR_SEND_PIN</span></div>
<div class="line"><a name="l00096"></a><span class="lineno"><a class="line" href="group__Timer.html#ga4cb394b3b749f9302940902fb05bd920">   96</a></span>&#160; </div>
<div class="line"><a name="l00103"></a><span class="lineno"><a class="line" href="group__Timer.html#ga8cca92581b5452eaac5b3075227c6c56">  103</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga8cca92581b5452eaac5b3075227c6c56">timerConfigForReceive</a>() {</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;}</div>
<div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="group__Timer.html#gae0ec21c275dd13fff83445ce6cc900d7">  108</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gae0ec21c275dd13fff83445ce6cc900d7">timerEnableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;}</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160; </div>
<div class="line"><a name="l00115"></a><span class="lineno"><a class="line" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">  115</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;}</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160; </div>
<div class="line"><a name="l00127"></a><span class="lineno"><a class="line" href="group__Timer.html#gab4f8dc26e10c0481e8859252afa4d42b">  127</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gab4f8dc26e10c0481e8859252afa4d42b">timerConfigForSend</a>(uint16_t aFrequencyKHz) {</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;}</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160; </div>
<div class="line"><a name="l00133"></a><span class="lineno"><a class="line" href="group__Timer.html#gac67e6a15f31989aa182389cd4a8729c9">  133</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gac67e6a15f31989aa182389cd4a8729c9">enableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;}</div>
<div class="line"><a name="l00138"></a><span class="lineno"><a class="line" href="group__Timer.html#ga352399811c67be16548d81a18e3cd337">  138</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga352399811c67be16548d81a18e3cd337">disableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;}</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160; </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="preprocessor">#elif defined(__AVR__)</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">/**********************************************************************************************************************</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment"> * Mapping of AVR boards to AVR timers</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment"> * For some CPU&#39;s you have the option to switch the timer and the hardware send pin</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment"> **********************************************************************************************************************/</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">/***************************************</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment"> * Plain AVR CPU&#39;s, no boards</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment"> ***************************************/</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">// Arduino Duemilanove, Diecimila, LilyPad, Mini, Fio, Nano, etc</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="preprocessor">#if defined(__AVR_ATmega328P__) || defined(__AVR_ATmega328PB__) || defined(__AVR_ATmega168__) \</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="preprocessor">    || defined(__AVR_ATmega88P__) || defined(__AVR_ATmega88PB__)</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="preprocessor">#  if !defined(IR_USE_AVR_TIMER1) &amp;&amp; !defined(IR_USE_AVR_TIMER2)</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">//#define IR_USE_AVR_TIMER1   // send pin = pin 9</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="preprocessor">#define IR_USE_AVR_TIMER2     // send pin = pin 3</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160; </div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">// Arduino Mega</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="preprocessor">#elif defined(__AVR_ATmega1280__) || defined(__AVR_ATmega2560__)</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="preprocessor">#  if !defined(IR_USE_AVR_TIMER1) &amp;&amp; !defined(IR_USE_AVR_TIMER2) &amp;&amp; !defined(IR_USE_AVR_TIMER3) &amp;&amp; !defined(IR_USE_AVR_TIMER4) &amp;&amp; !defined(IR_USE_AVR_TIMER5)</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">//#define IR_USE_AVR_TIMER1   // send pin = pin 11</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="preprocessor">#define IR_USE_AVR_TIMER2     // send pin = pin 9</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">//#define IR_USE_AVR_TIMER3   // send pin = pin 5</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">//#define IR_USE_AVR_TIMER4   // send pin = pin 6</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">//#define IR_USE_AVR_TIMER5   // send pin = pin 46</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160; </div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">// Leonardo</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="preprocessor">#elif defined(__AVR_ATmega32U4__) &amp;&amp; ! defined(TEENSYDUINO) &amp;&amp; ! defined(ARDUINO_AVR_PROMICRO)</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="preprocessor">#  if !defined(IR_USE_AVR_TIMER1) &amp;&amp; !defined(IR_USE_AVR_TIMER3) &amp;&amp; !defined(IR_USE_AVR_TIMER4_HS)</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">//#define IR_USE_AVR_TIMER1     // send pin = pin 9</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="preprocessor">#define IR_USE_AVR_TIMER3       // send pin = pin 5</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">//#define IR_USE_AVR_TIMER4_HS  // send pin = pin 13</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160; </div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">// Nano Every, Uno WiFi Rev2 and similar</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="preprocessor">#elif defined(__AVR_ATmega808__) || defined(__AVR_ATmega809__) || defined(__AVR_ATmega3208__) || defined(__AVR_ATmega3209__) \</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="preprocessor">     || defined(__AVR_ATmega1608__) || defined(__AVR_ATmega1609__) || defined(__AVR_ATmega4808__) || defined(__AVR_ATmega4809__) || defined(__AVR_ATtiny1604__)</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="preprocessor">#  if !defined(IR_USE_AVR_TIMER_B)</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="preprocessor">#define IR_USE_AVR_TIMER_B     //  send pin = pin 6 on ATmega4809 1 on ATmega4809</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160; </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="preprocessor">#elif defined(__AVR_ATtiny816__) || defined(__AVR_ATtiny1614__) || defined(__AVR_ATtiny1616__) || defined(__AVR_ATtiny3216__) || defined(__AVR_ATtiny3217__) // e.g. TinyCore boards</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="preprocessor">#  if !defined(IR_USE_AVR_TIMER_A) &amp;&amp; !defined(IR_USE_AVR_TIMER_D)</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="preprocessor">#define IR_USE_AVR_TIMER_A // use this if you use megaTinyCore, Tone is on TCB and millis() on TCD</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">//#define IR_USE_AVR_TIMER_D // use this if you use TinyCore</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160; </div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">// ATmega8u2, ATmega16U2, ATmega32U2, ATmega8 - Timer 2 does not work with existing code below</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="preprocessor">#elif defined(__AVR_ATmega8U2__) || defined(__AVR_ATmega16U2__)  || defined(__AVR_ATmega32U2__) || defined(__AVR_ATmega8__)</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="preprocessor">#  if !defined(IR_USE_AVR_TIMER1)</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="preprocessor">#define IR_USE_AVR_TIMER1     // send pin = pin C6</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160; </div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">// ATtiny84</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="preprocessor">#elif defined(__AVR_ATtiny84__) || defined(__AVR_ATtiny88__)</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="preprocessor">#  if !defined(IR_USE_AVR_TIMER1)</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="preprocessor">#define IR_USE_AVR_TIMER1     // send pin = pin 6</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160; </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="preprocessor">#elif  defined(__AVR_ATtiny87__) || defined(__AVR_ATtiny167__)</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="preprocessor">#  if !defined(IR_USE_AVR_TIMER1)</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="preprocessor">#define IR_USE_AVR_TIMER1   // send pin = pin PB1 / 8</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="preprocessor">#define USE_TIMER_CHANNEL_B</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160; </div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">//ATtiny85, 45, 25</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="preprocessor">#elif defined(__AVR_ATtiny25__) || defined(__AVR_ATtiny45__) || defined(__AVR_ATtiny85__)</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="preprocessor">#  if !defined(IR_USE_AVR_TIMER_TINY0) &amp;&amp; !defined(IR_USE_AVR_TIMER_TINY1)</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="preprocessor">#    if defined(ARDUINO_AVR_DIGISPARK) // tested with 16 and 8 MHz</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="preprocessor">#define IR_USE_AVR_TIMER_TINY0   // send pin = pin 1</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">// standard Digispark settings use timer 1 for millis() and micros()</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="preprocessor">#    else</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">// standard ATTinyCore settings use timer 0 for millis() and micros()</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="preprocessor">#define IR_USE_AVR_TIMER_TINY1   // send pin = pin 4</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="preprocessor">#    endif</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160; </div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">/***************************************</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment"> * SPARKFUN Pro Micro board</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment"> ***************************************/</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="preprocessor">#elif defined(ARDUINO_AVR_PROMICRO)</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="preprocessor">#  if !defined(IR_USE_AVR_TIMER1) &amp;&amp; !defined(IR_USE_AVR_TIMER3) &amp;&amp; !defined(IR_USE_AVR_TIMER4_HS)</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">//#define IR_USE_AVR_TIMER1     // send pin = pin 9</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="preprocessor">#define IR_USE_AVR_TIMER3       // send pin = pin 5</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">//#define IR_USE_AVR_TIMER4_HS  // send pin = pin 13</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160; </div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">/***************************************</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment"> * TEENSY Boards</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment"> ***************************************/</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">// Teensy 1.0</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="preprocessor">#elif defined(__AVR_AT90USB162__)</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="preprocessor">#  if !defined(IR_USE_AVR_TIMER1)</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="preprocessor">#define IR_USE_AVR_TIMER1     // send pin = pin 17</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">// Teensy++ 1.0 &amp; 2.0</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="preprocessor">#elif defined(__AVR_AT90USB646__) || defined(__AVR_AT90USB1286__)</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="preprocessor">#  if !defined(IR_USE_AVR_TIMER1) &amp;&amp; !defined(IR_USE_AVR_TIMER2) &amp;&amp; !defined(IR_USE_AVR_TIMER3)</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">//#define IR_USE_AVR_TIMER1   // send pin = pin 25</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="preprocessor">#define IR_USE_AVR_TIMER2     // send pin = pin 1</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">//#define IR_USE_AVR_TIMER3   // send pin = pin 16</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160; </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">// Teensy 2.0</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="preprocessor">#elif defined(__AVR_ATmega32U4__) &amp;&amp; defined(TEENSYDUINO)</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="preprocessor">#  if !defined(IR_USE_AVR_TIMER1) &amp;&amp; !defined(IR_USE_AVR_TIMER3) &amp;&amp; !defined(IR_USE_AVR_TIMER4_HS)</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">//#define IR_USE_AVR_TIMER1     // send pin = pin 14 (Teensy 2.0 - physical pin: B5)</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">//#define IR_USE_AVR_TIMER3     // send pin = pin 9  (Teensy 2.0 - physical pin: C6)</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="preprocessor">#define IR_USE_AVR_TIMER4_HS    // send pin = pin 10 (Teensy 2.0 - physical pin: C7)</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160; </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">/***************************************</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment"> * CPU&#39;s with MegaCore</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment"> ***************************************/</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">// MegaCore - ATmega64, ATmega128</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="preprocessor">#elif defined(__AVR_ATmega64__) || defined(__AVR_ATmega128__) || defined(__AVR_ATmega1281__) || defined(__AVR_ATmega2560__)</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="preprocessor">#  if !defined(IR_USE_AVR_TIMER1)</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="preprocessor">#define IR_USE_AVR_TIMER1     // send pin = pin 13</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160; </div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">/***************************************</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment"> * CPU&#39;s with MajorCore</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment"> ***************************************/</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="preprocessor">#elif defined(__AVR_ATmega8515__) || defined(__AVR_ATmega162__)</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="preprocessor">#  if !defined(IR_USE_AVR_TIMER1) &amp;&amp; !defined(IR_USE_AVR_TIMER3)</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="preprocessor">#define IR_USE_AVR_TIMER1     // send pin = pin 13</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">//#define IR_USE_AVR_TIMER3   // send pin = pin 12 - ATmega162 only</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160; </div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">/***************************************</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment"> * CPU&#39;s with MightyCore</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment"> ***************************************/</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">// MightyCore - ATmega1284</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="preprocessor">#elif defined(__AVR_ATmega1284__) || defined(__AVR_ATmega1284P__)</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="preprocessor">#  if !defined(IR_USE_AVR_TIMER1) &amp;&amp; !defined(IR_USE_AVR_TIMER2) &amp;&amp; !defined(IR_USE_AVR_TIMER3)</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">//#define IR_USE_AVR_TIMER1   // send pin = pin 13</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="preprocessor">#define IR_USE_AVR_TIMER2     // send pin = pin 14</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">//#define IR_USE_AVR_TIMER3   // send pin = pin 6</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160; </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">// MightyCore - ATmega164, ATmega324, ATmega644</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="preprocessor">#elif defined(__AVR_ATmega644__) || defined(__AVR_ATmega644P__) \</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="preprocessor">|| defined(__AVR_ATmega324P__) || defined(__AVR_ATmega324A__) \</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="preprocessor">|| defined(__AVR_ATmega324PA__) || defined(__AVR_ATmega164A__) \</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="preprocessor">|| defined(__AVR_ATmega164P__)</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="preprocessor">#  if !defined(IR_USE_AVR_TIMER1) &amp;&amp; !defined(IR_USE_AVR_TIMER2)</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">//#define IR_USE_AVR_TIMER1   // send pin = pin 13</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="preprocessor">#define IR_USE_AVR_TIMER2     // send pin = pin 14</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160; </div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment">// MightyCore - ATmega8535, ATmega16, ATmega32</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="preprocessor">#elif defined(__AVR_ATmega8535__) || defined(__AVR_ATmega16__) || defined(__AVR_ATmega32__)</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="preprocessor">#  if !defined(IR_USE_AVR_TIMER1)</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="preprocessor">#define IR_USE_AVR_TIMER1     // send pin = pin 13</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160; </div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="preprocessor">#endif // AVR CPU&#39;s</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">/**********************************************************************************************************************</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment"> * End of AVR mapping, start of AVR timers</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment"> **********************************************************************************************************************/</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment"> * AVR Timer1 (16 bits)</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="preprocessor">#if defined(IR_USE_AVR_TIMER1)</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160; </div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="preprocessor">#  if defined(TIMSK1)</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="preprocessor">#define TIMSK   TIMSK1 // use the value of TIMSK1 for the statements below</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160; </div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gae0ec21c275dd13fff83445ce6cc900d7">timerEnableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    TIMSK |= _BV(OCIE1A);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;}</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    TIMSK &amp;= ~_BV(OCIE1A);</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;}</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160; </div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="preprocessor">#  if defined(USE_TIMER_CHANNEL_B)</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="preprocessor">#    if defined(TIMER1_COMPB_vect)</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="preprocessor">#define TIMER_INTR_NAME       TIMER1_COMPB_vect</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="preprocessor">#    elif defined(TIM1_COMPB_vect)</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="preprocessor">#define TIMER_INTR_NAME       TIM1_COMPB_vect</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="preprocessor">#    endif</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="preprocessor">#    if defined(TIMER1_COMPA_vect)</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="preprocessor">#define TIMER_INTR_NAME       TIMER1_COMPA_vect</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="preprocessor">#    elif defined(TIM1_COMPA_vect)</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="preprocessor">#define TIMER_INTR_NAME       TIM1_COMPA_vect</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="preprocessor">#    endif</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160; </div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga8cca92581b5452eaac5b3075227c6c56">timerConfigForReceive</a>() {</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    TCCR1A = 0;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    TCCR1B = _BV(WGM12) | _BV(CS10); <span class="comment">// CTC mode, no prescaling</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    OCR1A = (F_CPU * <a class="code" href="IRremote_8hpp.html#a1c7eebb527483c272812530caa313d20">MICROS_PER_TICK</a>) / <a class="code" href="IRremote_8hpp.html#af33c8a218dd35ede965cf20a68a0068d">MICROS_IN_ONE_SECOND</a>; <span class="comment">// 16 * 50 = 800</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    TCNT1 = 0;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;}</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160; </div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="preprocessor">#  if defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="preprocessor">#    if defined(CORE_OC1A_PIN)</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="preprocessor">#define IR_SEND_PIN  CORE_OC1A_PIN  // Teensy</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160; </div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="preprocessor">#    elif defined(__AVR_ATmega1280__) || defined(__AVR_ATmega2560__)</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="preprocessor">#define IR_SEND_PIN  11             // Arduino Mega</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160; </div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">// MightyCore, MegaCore, MajorCore</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="preprocessor">#    elif defined(__AVR_ATmega1284__) || defined(__AVR_ATmega1284P__) \</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="preprocessor">|| defined(__AVR_ATmega644__) || defined(__AVR_ATmega644P__) \</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="preprocessor">|| defined(__AVR_ATmega324P__) || defined(__AVR_ATmega324A__) \</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="preprocessor">|| defined(__AVR_ATmega324PA__) || defined(__AVR_ATmega164A__) \</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="preprocessor">|| defined(__AVR_ATmega164P__) || defined(__AVR_ATmega32__) \</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="preprocessor">|| defined(__AVR_ATmega16__) || defined(__AVR_ATmega8535__) \</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="preprocessor">|| defined(__AVR_ATmega64__) || defined(__AVR_ATmega128__) \</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="preprocessor">|| defined(__AVR_ATmega1281__) || defined(__AVR_ATmega2561__) \</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="preprocessor">|| defined(__AVR_ATmega8515__) || defined(__AVR_ATmega162__)</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="preprocessor">#define IR_SEND_PIN  13</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160; </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="preprocessor">#    elif defined(__AVR_ATtiny84__)</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="preprocessor">#define IR_SEND_PIN  6</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160; </div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="preprocessor">#    elif defined(__AVR_ATtiny88__)</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="preprocessor">#define IR_SEND_PIN  8</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160; </div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="preprocessor">#    elif defined(__AVR_ATtiny87__) || defined(__AVR_ATtiny167__)</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment"> * !!! IR_SEND_PIN value must correspond to ENABLE_SEND_PWM_BY_TIMER below !!!</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="preprocessor">#      if defined(USE_TIMER_CHANNEL_B)</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="preprocessor">#define IR_SEND_PIN  PIN_PB1 // OC1BU / PB1 / Pin9 at ATTinyCore</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">//#define IR_SEND_PIN  PIN_PB3 // OC1BV / PB3 / Pin11 at ATTinyCore</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">//#define IR_SEND_PIN  PIN_PB5 // OC1BW / PB5 / Pin13 at ATTinyCore</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">//#define IR_SEND_PIN  PIN_PB7 // OC1BX / PB7 / Pin15 at ATTinyCore</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="preprocessor">#      else</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="preprocessor">#define IR_SEND_PIN  PIN_PB0 // OC1AU / PB1 / Pin8 at ATTinyCore</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">//#define IR_SEND_PIN  PIN_PB2 // OC1AV / PB3 / Pin10 at ATTinyCore</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">//#define IR_SEND_PIN  PIN_PB4 // OC1AW / PB5 / Pin12 at ATTinyCore</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">//#define IR_SEND_PIN  PIN_PB6 // OC1AX / PB6 / Pin14 at ATTinyCore</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="preprocessor">#      endif</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160; </div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="preprocessor">#    else</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="preprocessor">#define IR_SEND_PIN  9              // OC1A Arduino Duemilanove, Diecimila, LilyPad, Sparkfun Pro Micro, Leonardo, MH-ET Tiny88 etc.</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="preprocessor">#    endif // defined(CORE_OC1A_PIN)</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160; </div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="preprocessor">#    if defined(__AVR_ATtiny87__) || defined(__AVR_ATtiny167__)</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">// Clear OC1A/OC1B on Compare Match when up-counting. Set OC1A/OC1B on Compare Match when down counting.</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="preprocessor">#      if defined(USE_TIMER_CHANNEL_B)</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gac67e6a15f31989aa182389cd4a8729c9">enableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    TCNT1 = 0;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    TCCR1A |= _BV(COM1B1);</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    TCCR1D |= _BV(OC1BU); <span class="comment">// + enable OC1BU as output</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="comment">//TCNT1 = 0;  TCCR1A |= _BV(COM1B1); TCCR1D |= _BV(OC1BV); // + enable OC1BV as output</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="comment">//TCNT1 = 0;  TCCR1A |= _BV(COM1B1); TCCR1D |= _BV(OC1BW); // + enable OC1BW as output</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="comment">//TCNT1 = 0;  TCCR1A |= _BV(COM1B1); TCCR1D |= _BV(OC1BX); // + enable OC1BX as output</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;}</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="preprocessor">#      else</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga352399811c67be16548d81a18e3cd337">disableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    TCNT1 = 0;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    TCCR1A |= _BV(COM1A1);</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    TCCR1D |= _BV(OC1AU); <span class="comment">// + enable OC1BU as output</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="comment">//TCNT1 = 0;  TCCR1A |= _BV(COM1A1); TCCR1D |= _BV(OC1AV); // + enable OC1BV as output</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="comment">//TCNT1 = 0;  TCCR1A |= _BV(COM1A1); TCCR1D |= _BV(OC1AW); // + enable OC1BW as output</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="comment">//TCNT1 = 0;  TCCR1A |= _BV(COM1A1); TCCR1D |= _BV(OC1AX); // + enable OC1BX as output</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;}</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160; </div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="preprocessor">#      endif</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga352399811c67be16548d81a18e3cd337">disableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    TCCR1D = 0;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;}</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="preprocessor">#    else</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="preprocessor">#      if defined(USE_TIMER_CHANNEL_B)</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gac67e6a15f31989aa182389cd4a8729c9">enableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    TCNT1 = 0;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    TCCR1A |= _BV(COM1B1);  <span class="comment">// Clear OC1A/OC1B on Compare Match when up-counting. Set OC1A/OC1B on Compare Match when counting down.</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;}</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga352399811c67be16548d81a18e3cd337">disableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    TCCR1A &amp;= ~(_BV(COM1B1));</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;}</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="preprocessor">#      else</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gac67e6a15f31989aa182389cd4a8729c9">enableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    TCNT1 = 0;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    TCCR1A |= _BV(COM1A1); <span class="comment">// Clear OC1A/OC1B on Compare Match when up-counting. Set OC1A/OC1B on Compare Match when downcounting.</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;}</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga352399811c67be16548d81a18e3cd337">disableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    TCCR1A &amp;= ~(_BV(COM1A1));</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;}</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="preprocessor">#      endif</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="preprocessor">#    endif</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160; </div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment"> * timerConfigForSend() is used exclusively by IRsend::enableIROut()</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment"> * Set output pin mode and disable receive interrupt if it uses the same resource</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gab4f8dc26e10c0481e8859252afa4d42b">timerConfigForSend</a>(uint16_t aFrequencyKHz) {</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>();</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160; </div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="preprocessor">#  if (((F_CPU / 2000) / 38) &lt; 256)</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keyword">const</span> uint16_t tPWMWrapValue = (F_CPU / 2000) / (aFrequencyKHz); <span class="comment">// 210,52 for 38 kHz @16 MHz clock, 2000 instead of 1000 because of Phase Correct PWM</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    TCCR1A = _BV(WGM11); <span class="comment">// PWM, Phase Correct, Top is ICR1</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    TCCR1B = _BV(WGM13) | _BV(CS10); <span class="comment">// CS10 -&gt; no prescaling</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    ICR1 = tPWMWrapValue - 1;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="preprocessor">#    if defined(USE_TIMER_CHANNEL_B)</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    OCR1B = ((tPWMWrapValue * <a class="code" href="IRremote_8hpp.html#a6be706039d9083db8cb072478e0a09f8">IR_SEND_DUTY_CYCLE_PERCENT</a>) / 100) - 1;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="preprocessor">#    else</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    OCR1A = ((tPWMWrapValue * <a class="code" href="IRremote_8hpp.html#a6be706039d9083db8cb072478e0a09f8">IR_SEND_DUTY_CYCLE_PERCENT</a>) / 100) - 1;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="preprocessor">#    endif</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    TCNT1 = 0; <span class="comment">// not really required, since we have an 8 bit counter, but makes the signal more reproducible</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="preprocessor">#  else</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="keyword">const</span> uint16_t tPWMWrapValue = ((F_CPU / 8) / 2000) / (aFrequencyKHz); <span class="comment">// 2000 instead of 1000 because of Phase Correct PWM</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    TCCR1A = _BV(WGM11);<span class="comment">// PWM, Phase Correct, Top is ICR1</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    TCCR1B = _BV(WGM13) | _BV(CS11);<span class="comment">// CS11 -&gt; Prescaling by 8</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    ICR1 = tPWMWrapValue - 1;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="preprocessor">#    if defined(USE_TIMER_CHANNEL_B)</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    OCR1A = ((tPWMWrapValue * <a class="code" href="IRremote_8hpp.html#a6be706039d9083db8cb072478e0a09f8">IR_SEND_DUTY_CYCLE_PERCENT</a>) / 100) - 1;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="preprocessor">#    else</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    OCR1A = ((tPWMWrapValue * <a class="code" href="IRremote_8hpp.html#a6be706039d9083db8cb072478e0a09f8">IR_SEND_DUTY_CYCLE_PERCENT</a>) / 100) - 1;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="preprocessor">#    endif</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    TCNT1 = 0; <span class="comment">// not really required, since we have an 8 bit counter, but makes the signal more reproducible</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;}</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="preprocessor">#  endif // defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160; </div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment"> * AVR Timer2 (8 bits) // Tone timer on Uno</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="preprocessor">#elif defined(IR_USE_AVR_TIMER2)</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160; </div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gae0ec21c275dd13fff83445ce6cc900d7">timerEnableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    TIMSK2 = _BV(OCIE2B);   <span class="comment">// Output Compare Match A Interrupt Enable</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;}</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    TIMSK2 = 0;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;}</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="preprocessor">#define TIMER_INTR_NAME             TIMER2_COMPB_vect                   // We use TIMER2_COMPB_vect to be compatible with tone() library</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160; </div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="preprocessor">#define TIMER_COUNT_TOP  (F_CPU * MICROS_PER_TICK / MICROS_IN_ONE_SECOND)</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160; </div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga8cca92581b5452eaac5b3075227c6c56">timerConfigForReceive</a>() {</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="preprocessor">#  if (TIMER_COUNT_TOP &lt; 256)</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    TCCR2A = _BV(WGM21);</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    TCCR2B = _BV(CS20);</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    OCR2A = TIMER_COUNT_TOP;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    OCR2B = TIMER_COUNT_TOP;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    TCNT2 = 0;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="preprocessor">#  else</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    TCCR2A = _BV(WGM21);</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    TCCR2B = _BV(CS21);</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    OCR2A = TIMER_COUNT_TOP / 8;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    OCR2B = TIMER_COUNT_TOP / 8;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    TCNT2 = 0;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;}</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160; </div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="preprocessor">#  if defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="preprocessor">#    if defined(CORE_OC2B_PIN)</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="preprocessor">#define IR_SEND_PIN  CORE_OC2B_PIN  // Teensy</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160; </div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="preprocessor">#    elif defined(__AVR_ATmega1280__) || defined(__AVR_ATmega2560__)</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="preprocessor">#define IR_SEND_PIN  9              // Arduino Mega</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160; </div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="preprocessor">#    elif defined(__AVR_ATmega1284__) || defined(__AVR_ATmega1284P__) \</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="preprocessor">|| defined(__AVR_ATmega644__) || defined(__AVR_ATmega644P__) \</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="preprocessor">|| defined(__AVR_ATmega324P__) || defined(__AVR_ATmega324A__) \</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="preprocessor">|| defined(__AVR_ATmega324PA__) || defined(__AVR_ATmega164A__) \</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="preprocessor">|| defined(__AVR_ATmega164P__)</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="preprocessor">#define IR_SEND_PIN  14             // MightyCore, MegaCore</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160; </div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="preprocessor">#    else</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="preprocessor">#define IR_SEND_PIN  3              // Arduino Duemilanove, Diecimila, LilyPad, etc</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="preprocessor">#    endif // defined(CORE_OC2B_PIN)</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160; </div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gac67e6a15f31989aa182389cd4a8729c9">enableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    TCNT2 = 0;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    TCCR2A |= _BV(COM2B1);          <span class="comment">// Clear OC2B on Compare Match</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;}</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga352399811c67be16548d81a18e3cd337">disableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    TCCR2A &amp;= ~(_BV(COM2B1));      <span class="comment">// Normal port operation, OC2B disconnected.</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;}</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160; </div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="comment"> * timerConfigForSend() is used exclusively by IRsend::enableIROut()</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment"> * Set output pin mode and disable receive interrupt if it uses the same resource</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gab4f8dc26e10c0481e8859252afa4d42b">timerConfigForSend</a>(uint16_t aFrequencyKHz) {</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>();</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160; </div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="preprocessor">#  if (((F_CPU / 2000) / 38) &lt; 256)</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment">     * tPWMWrapValue is 210.52 for 38 kHz, 17.58 for 455 kHz @16 MHz clock.</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment">     * 210 -&gt; 38.095 kHz, 17 -&gt; 470.588 kHz @16 MHz clock.</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">     * We use 2000 instead of 1000 in the formula, because of Phase Correct PWM.</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="keyword">const</span> uint16_t tPWMWrapValue = (F_CPU / 2000) / (aFrequencyKHz);</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    TCCR2A = _BV(WGM20); <span class="comment">// PWM, Phase Correct, Top is OCR2A</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    TCCR2B = _BV(WGM22) | _BV(CS20); <span class="comment">// CS20 -&gt; no prescaling</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    OCR2A = tPWMWrapValue - 1; <span class="comment">// The top value for the timer.  The modulation frequency will be F_CPU / 2 / (OCR2A + 1).</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    OCR2B = ((tPWMWrapValue * <a class="code" href="IRremote_8hpp.html#a6be706039d9083db8cb072478e0a09f8">IR_SEND_DUTY_CYCLE_PERCENT</a>) / 100) - 1;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    TCNT2 = 0; <span class="comment">// not really required, since we have an 8 bit counter, but makes the signal more reproducible</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="preprocessor">#  else</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="keyword">const</span> uint16_t tPWMWrapValue = ((F_CPU / 8) / 2000) / (aFrequencyKHz); <span class="comment">// 2000 instead of 1000 because of Phase Correct PWM</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    TCCR2A = _BV(WGM20);<span class="comment">// PWM, Phase Correct, Top is OCR2A</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    TCCR2B = _BV(WGM22) | _BV(CS21);<span class="comment">// CS21 -&gt; Prescaling by 8</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    OCR2A = tPWMWrapValue - 1;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    OCR2B = ((tPWMWrapValue * <a class="code" href="IRremote_8hpp.html#a6be706039d9083db8cb072478e0a09f8">IR_SEND_DUTY_CYCLE_PERCENT</a>) / 100) - 1;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    TCNT2 = 0;<span class="comment">// not really required, since we have an 8 bit counter, but makes the signal more reproducible</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;}</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="preprocessor">#  endif // defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160; </div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="comment"> * AVR Timer3 (16 bits)</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="preprocessor">#elif defined(IR_USE_AVR_TIMER3)</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160; </div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gae0ec21c275dd13fff83445ce6cc900d7">timerEnableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    TIMSK3 = _BV(OCIE3B);</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;}</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    TIMSK3 = 0;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;}</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="preprocessor">#define TIMER_INTR_NAME             TIMER3_COMPB_vect</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160; </div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga8cca92581b5452eaac5b3075227c6c56">timerConfigForReceive</a>() {</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    TCCR3A = 0;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    TCCR3B = _BV(WGM32) | _BV(CS30);</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    OCR3A = F_CPU * <a class="code" href="IRremote_8hpp.html#a1c7eebb527483c272812530caa313d20">MICROS_PER_TICK</a> / <a class="code" href="IRremote_8hpp.html#af33c8a218dd35ede965cf20a68a0068d">MICROS_IN_ONE_SECOND</a>;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    OCR3B = F_CPU * <a class="code" href="IRremote_8hpp.html#a1c7eebb527483c272812530caa313d20">MICROS_PER_TICK</a> / <a class="code" href="IRremote_8hpp.html#af33c8a218dd35ede965cf20a68a0068d">MICROS_IN_ONE_SECOND</a>;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    TCNT3 = 0;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;}</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160; </div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="preprocessor">#  if defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="preprocessor">#    if defined(CORE_OC3A_PIN)</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="preprocessor">#define IR_SEND_PIN  CORE_OC3A_PIN  // Teensy</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160; </div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="preprocessor">#    elif defined(__AVR_ATmega1280__) || defined(__AVR_ATmega2560__) \</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="preprocessor">|| defined(__AVR_ATmega32U4__) || defined(ARDUINO_AVR_PROMICRO)</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="preprocessor">#define IR_SEND_PIN  5              // Arduino Mega, Arduino Leonardo, Sparkfun Pro Micro</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160; </div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="preprocessor">#    elif defined(__AVR_ATmega1284__) || defined(__AVR_ATmega1284P__)</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="preprocessor">#define IR_SEND_PIN  6              // MightyCore, MegaCore</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160; </div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="preprocessor">#    else</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="preprocessor">#error Please add OC3A pin number here</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="preprocessor">#    endif</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160; </div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gac67e6a15f31989aa182389cd4a8729c9">enableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    TCNT3 = 0;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    TCCR3A |= _BV(COM3A1);</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;}</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga352399811c67be16548d81a18e3cd337">disableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    TCCR3A &amp;= ~(_BV(COM3A1));</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;}</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160; </div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="comment"> * timerConfigForSend() is used exclusively by IRsend::enableIROut()</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="comment"> * Set output pin mode and disable receive interrupt if it uses the same resource</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gab4f8dc26e10c0481e8859252afa4d42b">timerConfigForSend</a>(uint16_t aFrequencyKHz) {</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="preprocessor">#if F_CPU &gt; 16000000</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="preprocessor">#error &quot;Creating timer PWM with timer 3 is not supported for F_CPU &gt; 16 MHz&quot;</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>();</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160; </div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="keyword">const</span> uint16_t tPWMWrapValue = (F_CPU / 2000) / (aFrequencyKHz); <span class="comment">// 210,52 for 38 kHz @16 MHz clock, 2000 instead of 1000 because of Phase Correct PWM</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    TCCR3A = _BV(WGM31);</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    TCCR3B = _BV(WGM33) | _BV(CS30); <span class="comment">// PWM, Phase Correct, ICRn as TOP, complete period is double of tPWMWrapValue</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    ICR3 = tPWMWrapValue - 1;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    OCR3A = ((tPWMWrapValue * <a class="code" href="IRremote_8hpp.html#a6be706039d9083db8cb072478e0a09f8">IR_SEND_DUTY_CYCLE_PERCENT</a>) / 100) - 1;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    TCNT3 = 0; <span class="comment">// required, since we have an 16 bit counter</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;}</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="preprocessor">#  endif // defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160; </div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;<span class="comment"> * AVR Timer4 (16 bits)</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="preprocessor">#elif defined(IR_USE_AVR_TIMER4)</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gae0ec21c275dd13fff83445ce6cc900d7">timerEnableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    TIMSK4 = _BV(OCIE4A);</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;}</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    TIMSK4 = 0;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;}</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="preprocessor">#define TIMER_INTR_NAME             TIMER4_COMPA_vect</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160; </div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga8cca92581b5452eaac5b3075227c6c56">timerConfigForReceive</a>() {</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    TCCR4A = 0;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    TCCR4B = _BV(WGM42) | _BV(CS40);</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    OCR4A = F_CPU * <a class="code" href="IRremote_8hpp.html#a1c7eebb527483c272812530caa313d20">MICROS_PER_TICK</a> / <a class="code" href="IRremote_8hpp.html#af33c8a218dd35ede965cf20a68a0068d">MICROS_IN_ONE_SECOND</a>;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    TCNT4 = 0;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;}</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160; </div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="preprocessor">#  if defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="preprocessor">#    if defined(CORE_OC4A_PIN)</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="preprocessor">#define IR_SEND_PIN  CORE_OC4A_PIN</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="preprocessor">#    elif defined(__AVR_ATmega1280__) || defined(__AVR_ATmega2560__)</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="preprocessor">#define IR_SEND_PIN  6  // Arduino Mega</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="preprocessor">#    else</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="preprocessor">#error Please add OC4A pin number here</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="preprocessor">#    endif</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160; </div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gac67e6a15f31989aa182389cd4a8729c9">enableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    TCNT4 = 0;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    TCCR4A |= _BV(COM4A1);</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;}</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga352399811c67be16548d81a18e3cd337">disableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    TCCR4A &amp;= ~(_BV(COM4A1));</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;}</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160; </div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gab4f8dc26e10c0481e8859252afa4d42b">timerConfigForSend</a>(uint16_t aFrequencyKHz) {</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="preprocessor">#if F_CPU &gt; 16000000</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="preprocessor">#error &quot;Creating timer PWM with timer 4 is not supported for F_CPU &gt; 16 MHz&quot;</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>();</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="keyword">const</span> uint16_t tPWMWrapValue = (F_CPU / 2000) / (aFrequencyKHz); <span class="comment">// 210,52 for 38 kHz @16 MHz clock, 2000 instead of 1000 because of Phase Correct PWM</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    TCCR4A = _BV(WGM41);</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    TCCR4B = _BV(WGM43) | _BV(CS40);</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    ICR4 = tPWMWrapValue - 1;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    OCR4A = ((tPWMWrapValue * <a class="code" href="IRremote_8hpp.html#a6be706039d9083db8cb072478e0a09f8">IR_SEND_DUTY_CYCLE_PERCENT</a>) / 100) - 1;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    TCNT4 = 0; <span class="comment">// required, since we have an 16 bit counter</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;}</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="preprocessor">#  endif // defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160; </div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="comment"> * AVR Timer4 (10 bits, high speed option)</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="preprocessor">#elif defined(IR_USE_AVR_TIMER4_HS)</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160; </div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gae0ec21c275dd13fff83445ce6cc900d7">timerEnableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    TIMSK4 = _BV(TOIE4);</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;}</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    TIMSK4 = 0;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;}</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="preprocessor">#define TIMER_INTR_NAME             TIMER4_OVF_vect</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160; </div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga8cca92581b5452eaac5b3075227c6c56">timerConfigForReceive</a>() {</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    TCCR4A = 0;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    TCCR4B = _BV(CS40);</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    TCCR4C = 0;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    TCCR4D = 0;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    TCCR4E = 0;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    TC4H = (F_CPU * <a class="code" href="IRremote_8hpp.html#a1c7eebb527483c272812530caa313d20">MICROS_PER_TICK</a> / <a class="code" href="IRremote_8hpp.html#af33c8a218dd35ede965cf20a68a0068d">MICROS_IN_ONE_SECOND</a>) &gt;&gt; 8;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    OCR4C = (F_CPU * <a class="code" href="IRremote_8hpp.html#a1c7eebb527483c272812530caa313d20">MICROS_PER_TICK</a> / <a class="code" href="IRremote_8hpp.html#af33c8a218dd35ede965cf20a68a0068d">MICROS_IN_ONE_SECOND</a>) &amp; 255;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    TC4H = 0;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    TCNT4 = 0;</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;}</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160; </div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="preprocessor">#  if defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="preprocessor">#    if defined(CORE_OC4A_PIN)</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="preprocessor">#define IR_SEND_PIN  CORE_OC4A_PIN  // Teensy 2.0</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;<span class="preprocessor">#    elif defined(ARDUINO_AVR_PROMICRO)</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="preprocessor">#define IR_SEND_PIN  5              // Sparkfun Pro Micro</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;<span class="preprocessor">#    elif defined(__AVR_ATmega32U4__)</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;<span class="preprocessor">#define IR_SEND_PIN  13             // Leonardo</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;<span class="preprocessor">#    else</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="preprocessor">#error Please add OC4A pin number here</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<span class="preprocessor">#    endif</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160; </div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;<span class="preprocessor">#    if defined(ARDUINO_AVR_PROMICRO) // Sparkfun Pro Micro</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gac67e6a15f31989aa182389cd4a8729c9">enableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    TCNT4 = 0;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    TCCR4A |= _BV(COM4A0);     <span class="comment">// Use complementary OC4A output on pin 5</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;}</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga352399811c67be16548d81a18e3cd337">disableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    TCCR4A &amp;= ~(_BV(COM4A0));  <span class="comment">// (Pro Micro does not map PC7 (32/ICP3/CLK0/OC4A)</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;}</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="comment">// of ATmega32U4 )</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="preprocessor">#    else</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gac67e6a15f31989aa182389cd4a8729c9">enableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    TCNT4 = 0;</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    TCCR4A |= _BV(COM4A1);</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    DDRC |= 1 &lt;&lt; 7;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;}</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga352399811c67be16548d81a18e3cd337">disableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    TCCR4A &amp;= ~(_BV(COM4A1));</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;}</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="preprocessor">#    endif</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160; </div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="comment"> * timerConfigForSend() is used exclusively by IRsend::enableIROut()</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="comment"> * Set output pin mode and disable receive interrupt if it uses the same resource</span></div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gab4f8dc26e10c0481e8859252afa4d42b">timerConfigForSend</a>(uint16_t aFrequencyKHz) {</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="preprocessor">#if F_CPU &gt; 16000000</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="preprocessor">#error &quot;Creating timer PWM with timer 4 HS is not supported for F_CPU &gt; 16 MHz&quot;</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>();</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160; </div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="keyword">const</span> uint16_t tPWMWrapValue = ((F_CPU / 2000) / (aFrequencyKHz)) - 1; <span class="comment">// 210,52 for 38 kHz @16 MHz clock, 2000 instead of 1000 because of Phase Correct PWM</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    TCCR4A = (1 &lt;&lt; PWM4A);</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    TCCR4B = _BV(CS40);</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    TCCR4C = 0;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    TCCR4D = (1 &lt;&lt; WGM40);</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    TCCR4E = 0;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    TC4H = tPWMWrapValue &gt;&gt; 8;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    OCR4C = tPWMWrapValue;</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    TC4H = (tPWMWrapValue * <a class="code" href="IRremote_8hpp.html#a6be706039d9083db8cb072478e0a09f8">IR_SEND_DUTY_CYCLE_PERCENT</a> / 100) &gt;&gt; 8;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    OCR4A = (tPWMWrapValue * <a class="code" href="IRremote_8hpp.html#a6be706039d9083db8cb072478e0a09f8">IR_SEND_DUTY_CYCLE_PERCENT</a> / 100) &amp; 255;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    TCNT4 = 0; <span class="comment">// not really required, since we have an 8 bit counter, but makes the signal more reproducible</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;}</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="preprocessor">#  endif // defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160; </div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="comment"> * AVR Timer5 (16 bits)</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="preprocessor">#elif defined(IR_USE_AVR_TIMER5)</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160; </div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gae0ec21c275dd13fff83445ce6cc900d7">timerEnableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    TIMSK5 = _BV(OCIE5A);</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;}</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    TIMSK5 = 0;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;}</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;<span class="preprocessor">#define TIMER_INTR_NAME             TIMER5_COMPA_vect</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160; </div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga8cca92581b5452eaac5b3075227c6c56">timerConfigForReceive</a>() {</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    TCCR5A = 0;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    TCCR5B = _BV(WGM52) | _BV(CS50);</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    OCR5A = F_CPU * <a class="code" href="IRremote_8hpp.html#a1c7eebb527483c272812530caa313d20">MICROS_PER_TICK</a> / <a class="code" href="IRremote_8hpp.html#af33c8a218dd35ede965cf20a68a0068d">MICROS_IN_ONE_SECOND</a>;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    TCNT5 = 0;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;}</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160; </div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="preprocessor">#  if defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="preprocessor">#    if defined(CORE_OC5A_PIN)</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="preprocessor">#define IR_SEND_PIN  CORE_OC5A_PIN</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;<span class="preprocessor">#    elif defined(__AVR_ATmega1280__) || defined(__AVR_ATmega2560__)</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;<span class="preprocessor">#define IR_SEND_PIN  46  // Arduino Mega</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;<span class="preprocessor">#    else</span></div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;<span class="preprocessor">#error Please add OC5A pin number here</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="preprocessor">#    endif</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160; </div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gac67e6a15f31989aa182389cd4a8729c9">enableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    TCNT5 = 0;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    TCCR5A |= _BV(COM5A1);</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;}</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga352399811c67be16548d81a18e3cd337">disableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    TCCR5A &amp;= ~(_BV(COM5A1));</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;}</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160; </div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;<span class="comment"> * timerConfigForSend() is used exclusively by IRsend::enableIROut()</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;<span class="comment"> * Set output pin mode and disable receive interrupt if it uses the same resource</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gab4f8dc26e10c0481e8859252afa4d42b">timerConfigForSend</a>(uint16_t aFrequencyKHz) {</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;<span class="preprocessor">#if F_CPU &gt; 16000000</span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;<span class="preprocessor">#error &quot;Creating timer PWM with timer 5 is not supported for F_CPU &gt; 16 MHz&quot;</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>();</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160; </div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <span class="keyword">const</span> uint16_t tPWMWrapValue = (F_CPU / 2000) / (aFrequencyKHz); <span class="comment">// 210,52 for 38 kHz @16 MHz clock, 2000 instead of 1000 because of Phase Correct PWM</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    TCCR5A = _BV(WGM51);</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    TCCR5B = _BV(WGM53) | _BV(CS50);</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    ICR5 = tPWMWrapValue - 1;</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    OCR5A = ((tPWMWrapValue * <a class="code" href="IRremote_8hpp.html#a6be706039d9083db8cb072478e0a09f8">IR_SEND_DUTY_CYCLE_PERCENT</a>) / 100) - 1;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    TCNT5 = 0; <span class="comment">// required, since we have an 16 bit counter</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;}</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="preprocessor">#  endif // defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160; </div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="comment"> * AVR Timer0 for ATtinies (8 bits)</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="preprocessor">#elif defined(IR_USE_AVR_TIMER_TINY0)</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160; </div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gae0ec21c275dd13fff83445ce6cc900d7">timerEnableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    TIMSK |= _BV(OCIE0A);</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;}</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    TIMSK &amp;= ~(_BV(OCIE0A));</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;}</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;<span class="preprocessor">#define TIMER_INTR_NAME                 TIMER0_COMPA_vect</span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160; </div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;<span class="preprocessor">#define TIMER_COUNT_TOP  (F_CPU * MICROS_PER_TICK / MICROS_IN_ONE_SECOND)</span></div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160; </div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga8cca92581b5452eaac5b3075227c6c56">timerConfigForReceive</a>() {</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;<span class="preprocessor">#  if (TIMER_COUNT_TOP &lt; 256)</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    TCCR0A = _BV(WGM01); <span class="comment">// CTC, Top is OCR0A</span></div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    TCCR0B = _BV(CS00);<span class="comment">// No prescaling</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    OCR0A = TIMER_COUNT_TOP;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    TCNT0 = 0;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;<span class="preprocessor">#  else</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    TCCR0A = _BV(WGM01);</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    TCCR0B = _BV(CS01); <span class="comment">// prescaling by 8</span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    OCR0A = TIMER_COUNT_TOP / 8;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    TCNT0 = 0;</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;}</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160; </div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;<span class="preprocessor">#  if defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;<span class="preprocessor">#define IR_SEND_PIN        1</span></div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160; </div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gac67e6a15f31989aa182389cd4a8729c9">enableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    TCNT0 = 0;</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    TCCR0A |= _BV(COM0B1);</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;}</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga352399811c67be16548d81a18e3cd337">disableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    TCCR0A &amp;= ~(_BV(COM0B1));</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;}</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160; </div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="comment"> * timerConfigForSend() is used exclusively by IRsend::enableIROut()</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="comment"> * Set output pin mode and disable receive interrupt if it uses the same resource</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gab4f8dc26e10c0481e8859252afa4d42b">timerConfigForSend</a>(uint16_t aFrequencyKHz) {</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;<span class="preprocessor">#if F_CPU &gt; 16000000</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="preprocessor">#error &quot;Creating timer PWM with timer TINY0 is not supported for F_CPU &gt; 16 MHz&quot;</span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>();</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160; </div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <span class="keyword">const</span> uint16_t tPWMWrapValue = (F_CPU / 2000) / (aFrequencyKHz); <span class="comment">// 210,52 for 38 kHz @16 MHz clock, 2000 instead of 1000 because of Phase Correct PWM</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    TCCR0A = _BV(WGM00); <span class="comment">// PWM, Phase Correct, Top is OCR0A</span></div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    TCCR0B = _BV(WGM02) | _BV(CS00); <span class="comment">// CS00 -&gt; no prescaling</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    OCR0A = tPWMWrapValue - 1;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    OCR0B = ((tPWMWrapValue * <a class="code" href="IRremote_8hpp.html#a6be706039d9083db8cb072478e0a09f8">IR_SEND_DUTY_CYCLE_PERCENT</a>) / 100) - 1;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    TCNT0 = 0; <span class="comment">// not really required, since we have an 8 bit counter, but makes the signal more reproducible</span></div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;}</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="preprocessor">#  endif // defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160; </div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;<span class="comment"> * AVR Timer1 for ATtinies (8 bits)</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;<span class="preprocessor">#elif defined(IR_USE_AVR_TIMER_TINY1)</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160; </div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gae0ec21c275dd13fff83445ce6cc900d7">timerEnableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    TIMSK |= _BV(OCIE1B);</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;}</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    TIMSK &amp;= ~(_BV(OCIE1B));</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;}</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;<span class="preprocessor">#define TIMER_INTR_NAME             TIMER1_COMPB_vect</span></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160; </div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;<span class="preprocessor">#define TIMER_COUNT_TOP  (F_CPU * MICROS_PER_TICK / MICROS_IN_ONE_SECOND)</span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160; </div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga8cca92581b5452eaac5b3075227c6c56">timerConfigForReceive</a>() {</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="preprocessor">#  if (TIMER_COUNT_TOP &lt; 256)</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    TCCR1 = _BV(CTC1) | _BV(CS10); <span class="comment">// Clear Timer/Counter on Compare Match, Top is OCR1C, No prescaling</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    GTCCR = 0;<span class="comment">// normal, non-PWM mode</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    OCR1C = TIMER_COUNT_TOP;</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    TCNT1 = 0;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<span class="preprocessor">#  else</span></div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    TCCR1 = _BV(CTC1) | _BV(CS12); <span class="comment">// Clear Timer/Counter on Compare Match, Top is OCR1C, prescaling by 8</span></div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    GTCCR = 0; <span class="comment">// normal, non-PWM mode</span></div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    OCR1C = TIMER_COUNT_TOP / 8;</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    TCNT1 = 0;</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;}</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160; </div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;<span class="preprocessor">#  if defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;<span class="preprocessor">#define IR_SEND_PIN        4</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160; </div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gac67e6a15f31989aa182389cd4a8729c9">enableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    TCNT1 = 0;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    GTCCR |= _BV(PWM1B) | _BV(COM1B0); <span class="comment">// Enable pin 4 PWM output (PB4 - Arduino D4)</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;}</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga352399811c67be16548d81a18e3cd337">disableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    GTCCR &amp;= ~(_BV(PWM1B) | _BV(COM1B0));</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;}</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160; </div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;<span class="comment"> * timerConfigForSend() is used exclusively by IRsend::enableIROut()</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;<span class="comment"> * Set output pin mode and disable receive interrupt if it uses the same resource</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gab4f8dc26e10c0481e8859252afa4d42b">timerConfigForSend</a>(uint16_t aFrequencyKHz) {</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>();</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160; </div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;<span class="preprocessor">#  if (((F_CPU / 1000) / 38) &lt; 256)</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    <span class="keyword">const</span> uint16_t tPWMWrapValue = (F_CPU / 1000) / (aFrequencyKHz); <span class="comment">// 421 @16 MHz, 26 @1 MHz and 38 kHz</span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    TCCR1 = _BV(CTC1) | _BV(CS10);<span class="comment">// CTC1 = 1: TOP value set to OCR1C, CS10 No Prescaling</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    OCR1C = tPWMWrapValue - 1;</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    OCR1B = ((tPWMWrapValue * <a class="code" href="IRremote_8hpp.html#a6be706039d9083db8cb072478e0a09f8">IR_SEND_DUTY_CYCLE_PERCENT</a>) / 100) - 1;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    TCNT1 = 0;<span class="comment">// not really required, since we have an 8 bit counter, but makes the signal more reproducible</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    GTCCR = _BV(PWM1B) | _BV(COM1B0);<span class="comment">// PWM1B = 1: Enable PWM for OCR1B, COM1B0 Clear on compare match</span></div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;<span class="preprocessor">#  else</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    <span class="keyword">const</span> uint16_t tPWMWrapValue = ((F_CPU / 2) / 1000) / (aFrequencyKHz); <span class="comment">// 210 for 16 MHz and 38 kHz</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    TCCR1 = _BV(CTC1) | _BV(CS11); <span class="comment">// CTC1 = 1: TOP value set to OCR1C, CS11 Prescaling by 2</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    OCR1C = tPWMWrapValue - 1;</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    OCR1B = ((tPWMWrapValue * <a class="code" href="IRremote_8hpp.html#a6be706039d9083db8cb072478e0a09f8">IR_SEND_DUTY_CYCLE_PERCENT</a>) / 100) - 1;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    TCNT1 = 0; <span class="comment">// not really required, since we have an 8 bit counter, but makes the signal more reproducible</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    GTCCR = _BV(PWM1B) | _BV(COM1B0); <span class="comment">// PWM1B = 1: Enable PWM for OCR1B, COM1B0 Clear on compare match</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;}</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;<span class="preprocessor">#  endif // defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160; </div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;<span class="comment"> * AVR TimerA for TinyCore 32 (16 bits)</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="preprocessor">#elif defined(IR_USE_AVR_TIMER_A)</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="preprocessor">#define TIMER_REQUIRES_RESET_INTR_PENDING</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga41e88e0b7edea76b3c77643ca7a3468f">timerResetInterruptPending</a>() {</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    TCA0.SINGLE.INTFLAGS = TCA_SINGLE_OVF_bm;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;}</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gae0ec21c275dd13fff83445ce6cc900d7">timerEnableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    TCA0.SINGLE.INTCTRL = TCA_SINGLE_OVF_bm;</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;}</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    TCA0.SINGLE.INTCTRL &amp;= ~(TCA_SINGLE_OVF_bm);</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;}</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;<span class="preprocessor">#define TIMER_INTR_NAME             TCA0_OVF_vect</span></div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;<span class="comment">// For MegaTinyCore:</span></div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;<span class="comment">// TCB1 is used by Tone()</span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="comment">// TCB2 is used by Servo, but we cannot hijack the ISR, so we must use a dedicated timer for the 20 ms interrupt</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;<span class="comment">// TCB3 is used by millis()</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;<span class="comment">// Must use TCA0, since TCBx have only prescaler %2. Use single (16bit) mode, because it seems to be easier :-)</span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga8cca92581b5452eaac5b3075227c6c56">timerConfigForReceive</a>() {</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    TCA0.SINGLE.CTRLD = 0; <span class="comment">// Single mode - required at least for MegaTinyCore</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    TCA0.SINGLE.CTRLB = TCA_SINGLE_WGMODE_NORMAL_gc;                        <span class="comment">// Normal mode, top = PER</span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    TCA0.SINGLE.PER = (F_CPU / <a class="code" href="IRremote_8hpp.html#af33c8a218dd35ede965cf20a68a0068d">MICROS_IN_ONE_SECOND</a>) * <a class="code" href="IRremote_8hpp.html#a1c7eebb527483c272812530caa313d20">MICROS_PER_TICK</a>;     <span class="comment">// 800 at 16 MHz</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    TCA0.SINGLE.CTRLA = TCA_SINGLE_CLKSEL_DIV1_gc | TCA_SINGLE_ENABLE_bm;   <span class="comment">// set prescaler to 1 and enable timer</span></div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;}</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160; </div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;<span class="preprocessor">#  if defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;<span class="preprocessor">#error &quot;No support for hardware PWM generation for ATtiny3216/17 etc.&quot;</span></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="preprocessor">#  endif // defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160; </div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;<span class="comment"> * AVR TimerB  (8 bits) for ATmega4809 (Nano Every, Uno WiFi Rev2)</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;<span class="preprocessor">#elif defined(IR_USE_AVR_TIMER_B)</span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160; </div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;<span class="comment">// ATmega4809 TCB0</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="preprocessor">#define TIMER_REQUIRES_RESET_INTR_PENDING</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga41e88e0b7edea76b3c77643ca7a3468f">timerResetInterruptPending</a>() {</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    TCB0.INTFLAGS = TCB_CAPT_bm;</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;}</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gae0ec21c275dd13fff83445ce6cc900d7">timerEnableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    TCB0.INTCTRL = TCB_CAPT_bm;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;}</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    TCB0.INTCTRL &amp;= ~(TCB_CAPT_bm);</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;}</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="preprocessor">#define TIMER_INTR_NAME             TCB0_INT_vect</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160; </div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga8cca92581b5452eaac5b3075227c6c56">timerConfigForReceive</a>() {</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    TCB0.CTRLB = (TCB_CNTMODE_INT_gc);  <span class="comment">// Periodic interrupt mode</span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    TCB0.CCMP = ((F_CPU * <a class="code" href="IRremote_8hpp.html#a1c7eebb527483c272812530caa313d20">MICROS_PER_TICK</a>) / <a class="code" href="IRremote_8hpp.html#af33c8a218dd35ede965cf20a68a0068d">MICROS_IN_ONE_SECOND</a>);</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    TCB0.INTFLAGS = TCB_CAPT_bm;  <span class="comment">// reset interrupt flags</span></div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    TCB0.CTRLA = (TCB_CLKSEL_CLKDIV1_gc) | (TCB_ENABLE_bm);</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;}</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160; </div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;<span class="preprocessor">#  if defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;<span class="preprocessor">#    if defined(__AVR_ATmega4808__) || defined(__AVR_ATmega4809__)</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;<span class="preprocessor">#define IR_SEND_PIN        6 // PF4 on ATmega4809 / Nano Every (see pins_arduino.h digital_pin_to_timer)</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;<span class="preprocessor">#    else</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;<span class="preprocessor">#error SEND_PWM_BY_TIMER not yet supported for this CPU</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;<span class="preprocessor">#    endif</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160; </div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gac67e6a15f31989aa182389cd4a8729c9">enableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    TCB0.CNT = 0;</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    TCB0.CTRLB |= TCB_CCMPEN_bm;    <span class="comment">// set Compare/Capture Output Enable</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;}</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga352399811c67be16548d81a18e3cd337">disableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    TCB0.CTRLB &amp;= ~(TCB_CCMPEN_bm);</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;}</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160; </div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;<span class="comment"> * timerConfigForSend() is used exclusively by IRsend::enableIROut()</span></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;<span class="comment"> * Set output pin mode and disable receive interrupt if it uses the same resource</span></div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gab4f8dc26e10c0481e8859252afa4d42b">timerConfigForSend</a>(uint16_t aFrequencyKHz) {</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="preprocessor">#if F_CPU &gt; 16000000</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;        <span class="comment">// we have only prescaler 2 or must take clock of timer A (which is non deterministic)</span></div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;<span class="preprocessor">#error &quot;Creating timer PWM with timer TCB0 is not possible for F_CPU &gt; 16 MHz&quot;</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>();</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160; </div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    <span class="keyword">const</span> uint16_t tPWMWrapValue = (F_CPU / 2000) / (aFrequencyKHz); <span class="comment">// 210,52 for 38 kHz @16 MHz clock, 2000 instead of 1000 because of using CLK / 2</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    TCB0.CTRLB = TCB_CNTMODE_PWM8_gc; <span class="comment">// 8 bit PWM mode</span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    TCB0.CCMPL = tPWMWrapValue - 1; <span class="comment">// Period of 8 bit PWM</span></div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    TCB0.CCMPH = ((tPWMWrapValue * <a class="code" href="IRremote_8hpp.html#a6be706039d9083db8cb072478e0a09f8">IR_SEND_DUTY_CYCLE_PERCENT</a>) / 100) - 1; <span class="comment">// Duty cycle of waveform of 8 bit PWM</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    TCB0.CTRLA = (TCB_CLKSEL_CLKDIV2_gc) | (TCB_ENABLE_bm); <span class="comment">// use CLK / 2</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    TCB0.CNT = 0; <span class="comment">// not really required, since we have an 8 bit counter, but makes the signal more reproducible</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;}</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;<span class="preprocessor">#  endif // defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160; </div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;<span class="comment"> * AVR TimerD for TinyCore 32 (16 bits)</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;<span class="preprocessor">#elif defined(IR_USE_AVR_TIMER_D)</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160; </div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="preprocessor">#define TIMER_REQUIRES_RESET_INTR_PENDING</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga41e88e0b7edea76b3c77643ca7a3468f">timerResetInterruptPending</a>() {</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    TCD0.INTFLAGS = TCD_OVF_bm;</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;}</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gae0ec21c275dd13fff83445ce6cc900d7">timerEnableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    TCD0.INTCTRL = TCD_OVF_bm;</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;}</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    TCD0.INTCTRL = 0;</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;}</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="preprocessor">#define TIMER_INTR_NAME             TCD0_OVF_vect</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160; </div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga8cca92581b5452eaac5b3075227c6c56">timerConfigForReceive</a>() {</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    TCD0.CTRLA = 0;                     <span class="comment">// reset enable bit in order to unprotect the other bits</span></div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    TCD0.CTRLB = TCD_WGMODE_ONERAMP_gc; <span class="comment">// must be set since it is used by PWM</span></div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="comment">//    TCD0.CMPBSET = 80;</span></div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    TCD0.CMPBCLR = ((F_CPU * <a class="code" href="IRremote_8hpp.html#a1c7eebb527483c272812530caa313d20">MICROS_PER_TICK</a>) / <a class="code" href="IRremote_8hpp.html#af33c8a218dd35ede965cf20a68a0068d">MICROS_IN_ONE_SECOND</a>) - 1;</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160; </div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    _PROTECTED_WRITE(TCD0.FAULTCTRL, 0); <span class="comment">// must disable WOA output at pin 13/PA4</span></div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160; </div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    TCD0.INTFLAGS = TCD_OVF_bm;         <span class="comment">// reset interrupt flags</span></div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    <span class="comment">// check enable ready</span></div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;<span class="comment">//    while ((TCD0.STATUS &amp; TCD_ENRDY_bm) == 0); // Wait for Enable Ready to be high - I guess it is not required</span></div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    <span class="comment">// enable timer - this locks the other bits and static registers and activates values in double buffered registers</span></div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    TCD0.CTRLA = TCD_ENABLE_bm | TCD_CLKSEL_SYSCLK_gc | TCD_CNTPRES_DIV1_gc; <span class="comment">// System clock, no prescale, no synchronization prescaler</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;}</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160; </div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="preprocessor">#  if defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="preprocessor">#define IR_SEND_PIN 13</span></div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160; </div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;<span class="keywordtype">void</span> timerEnableSendPWM() {</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    TCD0.CTRLA = 0;                                                 <span class="comment">// reset enable bit in order to unprotect the other bits</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    _PROTECTED_WRITE(TCD0.FAULTCTRL, FUSE_CMPAEN_bm);                                             <span class="comment">// enable WOA output at pin 13/PA4</span></div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;<span class="comment">//    _PROTECTED_WRITE(TCD0.FAULTCTRL, FUSE_CMPAEN_bm | FUSE_CMPBEN_bm); // enable WOA + WOB output pins at 13/PA4 + 14/PA5</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    TCD0.CTRLA = TCD_ENABLE_bm | TCD_CLKSEL_SYSCLK_gc | TCD_CNTPRES_DIV1_gc; <span class="comment">// System clock, no prescale, no synchronization prescaler</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;}</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160; </div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gac67e6a15f31989aa182389cd4a8729c9">enableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    timerEnableSendPWM();</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;}</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga352399811c67be16548d81a18e3cd337">disableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;    TCD0.CTRLA = 0; <span class="comment">// do not disable output, disable complete timer</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;}</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160; </div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="comment"> * timerConfigForSend() is used exclusively by IRsend::enableIROut()</span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="comment"> * Set output pin mode and disable receive interrupt if it uses the same resource</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gab4f8dc26e10c0481e8859252afa4d42b">timerConfigForSend</a>(uint16_t aFrequencyKHz) {</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>();</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160; </div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    <span class="keyword">const</span> uint16_t tPWMWrapValue = (F_CPU / 1000) / (aFrequencyKHz);    <span class="comment">// 526,31 for 38 kHz @20 MHz clock</span></div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    <span class="comment">// use one ramp mode and overflow interrupt</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    TCD0.CTRLA = 0;        <span class="comment">// reset enable bit in order to unprotect the other bits</span></div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="comment">//    while ((TCD0.STATUS &amp; TCD_ENRDY_bm) == 0);                      // Wait for Enable Ready to be high - I guess it is not required</span></div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    TCD0.CTRLB = TCD_WGMODE_ONERAMP_gc;        <span class="comment">// must be set since it is used by PWM</span></div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    TCD0.CTRLC = 0;        <span class="comment">// reset WOx output settings</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;<span class="comment">//    TCD0.CMPBSET = 80;</span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    TCD0.CMPBCLR = tPWMWrapValue - 1;</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160; </div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    <span class="comment">// Generate duty cycle signal for debugging etc.</span></div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    TCD0.CMPASET = 0;</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    TCD0.CMPACLR = (tPWMWrapValue * <a class="code" href="IRremote_8hpp.html#a6be706039d9083db8cb072478e0a09f8">IR_SEND_DUTY_CYCLE_PERCENT</a> / 100) - 1;        <span class="comment">// duty cycle for WOA</span></div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160; </div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    TCD0.INTFLAGS = TCD_OVF_bm;        <span class="comment">// reset interrupt flags</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    TCD0.INTCTRL = TCD_OVF_bm;        <span class="comment">// overflow interrupt</span></div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    <span class="comment">// Do not enable timer, this is done at timerEnablSendPWM()</span></div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;}</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;<span class="preprocessor">#  endif // defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160; </div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;<span class="preprocessor">#error Internal code configuration error, no timer functions implemented for this AVR CPU / board</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;<span class="preprocessor">#endif //defined(IR_USE_AVR_TIMER*)</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;<span class="comment">/**********************************************************************************************************************</span></div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;<span class="comment"> * End of AVR timers</span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="comment"> **********************************************************************************************************************/</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160; </div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="comment">/**********************************************</span></div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;<span class="comment"> * Uno R4 boards</span></div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;<span class="comment"> **********************************************/</span></div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;<span class="preprocessor">#elif defined(ARDUINO_ARCH_RENESAS)</span></div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;<span class="preprocessor">#include &quot;FspTimer.h&quot;</span></div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;FspTimer s50usTimer;</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160; </div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;<span class="comment">// Undefine ISR, because we register/call the plain function IRReceiveTimerInterruptHandler()</span></div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;<span class="preprocessor">#  if defined(ISR)</span></div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;<span class="preprocessor">#undef ISR</span></div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160; </div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;<span class="comment">// callback method used by timer</span></div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;<span class="keywordtype">void</span> IRTimerInterruptHandlerHelper(timer_callback_args_t __attribute((unused)) *p_args) {</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;    <a class="code" href="group__Receiving.html#ga770e03720a79491d7ddf347ad4b9e484">IRReceiveTimerInterruptHandler</a>();</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;}</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gae0ec21c275dd13fff83445ce6cc900d7">timerEnableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;<span class="comment">//    s50usTimer.enable_overflow_irq();</span></div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    s50usTimer.start();</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;}</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<span class="comment">//    s50usTimer.disable_overflow_irq();</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    s50usTimer.stop(); <span class="comment">// May save power</span></div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;}</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160; </div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga8cca92581b5452eaac5b3075227c6c56">timerConfigForReceive</a>() {</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    uint8_t tTimerType = GPT_TIMER;</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    int8_t tIndex = FspTimer::get_available_timer(tTimerType); <span class="comment">// Get first unused channel. Here we need the address of tTimerType</span></div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    <span class="keywordflow">if</span> (tIndex &lt; 0 || tTimerType != GPT_TIMER) {</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;        <span class="comment">// here we found no unused GPT channel</span></div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;        tIndex = FspTimer::get_available_timer(tTimerType, <span class="keyword">true</span>); <span class="comment">// true to force use of already used PWM channel. Sets &quot;force_pwm_reserved&quot; if timer found</span></div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;        <span class="keywordflow">if</span> (tIndex &lt; 0) {</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;            <span class="comment">// If we already get an tIndex &lt; 0 we have an error, but do not know how to handle :-(</span></div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;        }</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    }</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    s50usTimer.begin(TIMER_MODE_PERIODIC, tTimerType, tIndex, <a class="code" href="IRremote_8hpp.html#af33c8a218dd35ede965cf20a68a0068d">MICROS_IN_ONE_SECOND</a> / <a class="code" href="IRremote_8hpp.html#a1c7eebb527483c272812530caa313d20">MICROS_PER_TICK</a>, 0.0,</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;            IRTimerInterruptHandlerHelper);</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    s50usTimer.setup_overflow_irq();</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    s50usTimer.open(); <span class="comment">// In turn calls R_GPT_Enable()</span></div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    s50usTimer.stop(); <span class="comment">// May save power</span></div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;}</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160; </div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;<span class="preprocessor">#  if defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;<span class="preprocessor">#error PWM generation by hardware not yet implemented for Arduino Uno R4</span></div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;<span class="comment">// Not yet implemented</span></div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gac67e6a15f31989aa182389cd4a8729c9">enableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;}</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga352399811c67be16548d81a18e3cd337">disableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;}</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160; </div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;<span class="comment"> * timerConfigForSend() is used exclusively by IRsend::enableIROut()</span></div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gab4f8dc26e10c0481e8859252afa4d42b">timerConfigForSend</a>(uint16_t aFrequencyKHz) {</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;<span class="preprocessor">#    if defined(IR_SEND_PIN)</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;<span class="preprocessor">#    else</span></div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;<span class="preprocessor">#    endif</span></div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;}</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160; </div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;<span class="comment">/**********************************************</span></div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;<span class="comment"> * Teensy 3.0 / Teensy 3.1 / Teensy 3.2 boards</span></div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;<span class="comment"> **********************************************/</span></div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;<span class="preprocessor">#elif defined(__MK20DX128__) || defined(__MK20DX256__) || defined(__MK64FX512__) || defined(__MK66FX1M0__)</span></div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160; </div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="comment">// Special carrier modulator timer for Teensy 3.0 / Teensy 3.1 / Teensy 3.2</span></div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;<span class="preprocessor">#define TIMER_REQUIRES_RESET_INTR_PENDING</span></div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga41e88e0b7edea76b3c77643ca7a3468f">timerResetInterruptPending</a>() {</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    uint8_t tmp __attribute__((unused)) = CMT_MSC;</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    CMT_CMD2 = 30;</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;}</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gae0ec21c275dd13fff83445ce6cc900d7">timerEnableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    NVIC_ENABLE_IRQ(IRQ_CMT);</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    NVIC_SET_PRIORITY(IRQ_CMT, 48);</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;}</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    NVIC_DISABLE_IRQ(IRQ_CMT);</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;}</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160; </div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;<span class="preprocessor">#define TIMER_INTR_NAME     cmt_isr</span></div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;<span class="preprocessor">#  if defined(ISR)</span></div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;<span class="preprocessor">#undef ISR</span></div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;<span class="preprocessor">#define ISR(f) void f(void)</span></div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160; </div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;<span class="preprocessor">#define CMT_PPS_DIV  ((F_BUS + 7999999) / 8000000)</span></div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;<span class="preprocessor">#  if F_BUS &lt; 8000000</span></div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;<span class="preprocessor">#error IRremote requires at least 8 MHz on Teensy 3.x</span></div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160; </div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga8cca92581b5452eaac5b3075227c6c56">timerConfigForReceive</a>() {</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    SIM_SCGC4 |= SIM_SCGC4_CMT;</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    CMT_PPS = CMT_PPS_DIV - 1;</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    CMT_CGH1 = 1;</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    CMT_CGL1 = 1;</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;    CMT_CMD1 = 0;</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    CMT_CMD2 = 30;</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    CMT_CMD3 = 0;</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    CMT_CMD4 = (F_BUS / 160000 + CMT_PPS_DIV / 2) / CMT_PPS_DIV - 31;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;    CMT_OC = 0;</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    CMT_MSC = 0x03;</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;}</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160; </div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;<span class="preprocessor">#  if defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;<span class="preprocessor">#define IR_SEND_PIN  5</span></div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160; </div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gac67e6a15f31989aa182389cd4a8729c9">enableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;        CORE_PIN5_CONFIG = PORT_PCR_MUX(2) | PORT_PCR_DSE | PORT_PCR_SRE;</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;    } <span class="keywordflow">while</span> (0);</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;}</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga352399811c67be16548d81a18e3cd337">disableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;        CORE_PIN5_CONFIG = PORT_PCR_MUX(1) | PORT_PCR_DSE | PORT_PCR_SRE;</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;    } <span class="keywordflow">while</span> (0);</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;}</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160; </div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;<span class="comment"> * timerConfigForSend() is used exclusively by IRsend::enableIROut()</span></div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;<span class="comment"> * Set output pin mode and disable receive interrupt if it uses the same resource</span></div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gab4f8dc26e10c0481e8859252afa4d42b">timerConfigForSend</a>(uint16_t aFrequencyKHz) {</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>(); <span class="comment">// TODO really required here? Do we have a common resource for Teensy3.0, 3.1</span></div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;<span class="preprocessor">#    if defined(IR_SEND_PIN)</span></div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    pinMode(<a class="code" href="group__Timer.html#ga4cb394b3b749f9302940902fb05bd920">IR_SEND_PIN</a>, OUTPUT);</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;<span class="preprocessor">#    else</span></div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    pinMode(<a class="code" href="group__Sending.html#gafba8232b747be85f72c1c4612780d5cf">IrSender</a>.<a class="code" href="classIRsend.html#a39f9782dd884b804bcf0034ab71ac202">sendPin</a>, OUTPUT);</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;<span class="preprocessor">#    endif</span></div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160; </div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;    SIM_SCGC4 |= SIM_SCGC4_CMT;</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;    SIM_SOPT2 |= SIM_SOPT2_PTD7PAD;</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    CMT_PPS = CMT_PPS_DIV - 1;</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    CMT_CGH1 = ((F_BUS / CMT_PPS_DIV / 3000) + ((aFrequencyKHz) / 2)) / (aFrequencyKHz);</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;    CMT_CGL1 = ((F_BUS / CMT_PPS_DIV / 1500) + ((aFrequencyKHz) / 2)) / (aFrequencyKHz);</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    CMT_CMD1 = 0;</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;    CMT_CMD2 = 30;</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;    CMT_CMD3 = 0;</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;    CMT_CMD4 = 0;</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;    CMT_OC = 0x60;</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;    CMT_MSC = 0x01;</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;}</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;<span class="preprocessor">#  endif // defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160; </div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;<span class="comment">/***************************************</span></div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;<span class="comment"> * Teensy-LC board</span></div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;<span class="comment"> ***************************************/</span></div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;<span class="preprocessor">#elif defined(__MKL26Z64__)</span></div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160; </div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;<span class="comment">// defines for TPM1 timer on Teensy-LC</span></div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;<span class="preprocessor">#define TIMER_REQUIRES_RESET_INTR_PENDING</span></div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga41e88e0b7edea76b3c77643ca7a3468f">timerResetInterruptPending</a>() {</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    FTM1_SC |= FTM_SC_TOF;</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;}</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gae0ec21c275dd13fff83445ce6cc900d7">timerEnableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    NVIC_ENABLE_IRQ(IRQ_FTM1);</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    NVIC_SET_PRIORITY(IRQ_FTM1, 0);</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;}</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    NVIC_DISABLE_IRQ(IRQ_FTM1);</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;}</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;<span class="preprocessor">#define TIMER_INTR_NAME                 ftm1_isr</span></div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;<span class="preprocessor">#  if defined(ISR)</span></div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;<span class="preprocessor">#undef ISR</span></div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;<span class="preprocessor">#define ISR(f) void f(void)</span></div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160; </div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga8cca92581b5452eaac5b3075227c6c56">timerConfigForReceive</a>() {</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    SIM_SCGC6 |= SIM_SCGC6_TPM1;</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    FTM1_SC = 0;</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    FTM1_CNT = 0;</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    FTM1_MOD = (F_PLL / 40000) - 1;</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;    FTM1_C0V = 0;</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    FTM1_SC = FTM_SC_CLKS(1) | FTM_SC_PS(0) | FTM_SC_TOF | FTM_SC_TOIE;</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;}</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160; </div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;<span class="preprocessor">#  if defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;<span class="preprocessor">#define IR_SEND_PIN        16</span></div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160; </div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gac67e6a15f31989aa182389cd4a8729c9">enableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;    FTM1_CNT = 0;</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    CORE_PIN16_CONFIG = PORT_PCR_MUX(3) | PORT_PCR_DSE | PORT_PCR_SRE;</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;}</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga352399811c67be16548d81a18e3cd337">disableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    CORE_PIN16_CONFIG = PORT_PCR_MUX(1) | PORT_PCR_SRE;</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;}</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160; </div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;<span class="comment"> * timerConfigForSend() is used exclusively by IRsend::enableIROut()</span></div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;<span class="comment"> * Set output pin mode and disable receive interrupt if it uses the same resource</span></div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gab4f8dc26e10c0481e8859252afa4d42b">timerConfigForSend</a>(uint16_t aFrequencyKHz) {</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;    <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>();</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;<span class="preprocessor">#    if defined(IR_SEND_PIN)</span></div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;    pinMode(<a class="code" href="group__Timer.html#ga4cb394b3b749f9302940902fb05bd920">IR_SEND_PIN</a>, OUTPUT);</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;<span class="preprocessor">#    else</span></div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;    pinMode(<a class="code" href="group__Sending.html#gafba8232b747be85f72c1c4612780d5cf">IrSender</a>.<a class="code" href="classIRsend.html#a39f9782dd884b804bcf0034ab71ac202">sendPin</a>, OUTPUT);</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;<span class="preprocessor">#    endif</span></div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160; </div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;    SIM_SCGC6 |= SIM_SCGC6_TPM1;</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    FTM1_SC = 0;</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    FTM1_CNT = 0;</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;    FTM1_MOD = ((F_PLL / 2000) / aFrequencyKHz) - 1;</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;    FTM1_C0V = ((F_PLL / 6000) / aFrequencyKHz) - 1;</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    FTM1_SC = FTM_SC_CLKS(1) | FTM_SC_PS(0);</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;}</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;<span class="preprocessor">#  endif // defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160; </div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;<span class="comment">/***************************************</span></div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;<span class="comment"> * Teensy 4.0, 4.1, MicroMod boards</span></div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;<span class="comment"> ***************************************/</span></div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;<span class="preprocessor">#elif defined(__IMXRT1062__)</span></div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;<span class="comment">// forward declare ISR function (will be implemented by IRReceive.hpp)</span></div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;<span class="keywordtype">void</span> pwm1_3_isr();</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160; </div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;<span class="comment">// defines for FlexPWM1 timer on Teensy 4</span></div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;<span class="preprocessor">#define TIMER_REQUIRES_RESET_INTR_PENDING</span></div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga41e88e0b7edea76b3c77643ca7a3468f">timerResetInterruptPending</a>() {</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    FLEXPWM1_SM3STS = FLEXPWM_SMSTS_RF;</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;}</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gae0ec21c275dd13fff83445ce6cc900d7">timerEnableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;    attachInterruptVector(IRQ_FLEXPWM1_3, pwm1_3_isr);</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    FLEXPWM1_SM3STS = FLEXPWM_SMSTS_RF;</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    FLEXPWM1_SM3INTEN = FLEXPWM_SMINTEN_RIE;</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;    NVIC_ENABLE_IRQ (IRQ_FLEXPWM1_3), NVIC_SET_PRIORITY(IRQ_FLEXPWM1_3, 48);</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;}</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    NVIC_DISABLE_IRQ (IRQ_FLEXPWM1_3);</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;}</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;<span class="preprocessor">#define TIMER_INTR_NAME                 pwm1_3_isr</span></div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;<span class="preprocessor">#  if defined(ISR)</span></div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;<span class="preprocessor">#undef ISR</span></div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;<span class="preprocessor">#define ISR(f) void (f)(void)</span></div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160; </div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga8cca92581b5452eaac5b3075227c6c56">timerConfigForReceive</a>() {</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;    uint32_t period = (float) F_BUS_ACTUAL * (<span class="keywordtype">float</span>) (<a class="code" href="IRremote_8hpp.html#a1c7eebb527483c272812530caa313d20">MICROS_PER_TICK</a>) * 0.0000005f;</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;    uint32_t prescale = 0;</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;    <span class="keywordflow">while</span> (period &gt; 32767) {</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;        period = period &gt;&gt; 1;</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;        <span class="keywordflow">if</span> (prescale &lt; 7)</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;            prescale++;</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;    }</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;    FLEXPWM1_FCTRL0 |= FLEXPWM_FCTRL0_FLVL(8);</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    FLEXPWM1_FSTS0 = 0x0008;</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;    FLEXPWM1_MCTRL |= FLEXPWM_MCTRL_CLDOK(8);</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    FLEXPWM1_SM3CTRL2 = FLEXPWM_SMCTRL2_INDEP;</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    FLEXPWM1_SM3CTRL = FLEXPWM_SMCTRL_HALF | FLEXPWM_SMCTRL_PRSC(prescale);</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;    FLEXPWM1_SM3INIT = -period;</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;    FLEXPWM1_SM3VAL0 = 0;</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    FLEXPWM1_SM3VAL1 = period;</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    FLEXPWM1_SM3VAL2 = 0;</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    FLEXPWM1_SM3VAL3 = 0;</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;    FLEXPWM1_SM3VAL4 = 0;</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    FLEXPWM1_SM3VAL5 = 0;</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;    FLEXPWM1_MCTRL |= FLEXPWM_MCTRL_LDOK(8) | FLEXPWM_MCTRL_RUN(8);</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;}</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160; </div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;<span class="preprocessor">#  if defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;<span class="preprocessor">#define IR_SEND_PIN        7</span></div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gac67e6a15f31989aa182389cd4a8729c9">enableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    FLEXPWM1_OUTEN |= FLEXPWM_OUTEN_PWMA_EN(8);</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;    IOMUXC_SW_MUX_CTL_PAD_GPIO_B1_00 = 6;</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;}</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160; </div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga352399811c67be16548d81a18e3cd337">disableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;    IOMUXC_SW_MUX_CTL_PAD_GPIO_B1_00 = 5;</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;    FLEXPWM1_OUTEN &amp;= ~FLEXPWM_OUTEN_PWMA_EN(8);</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;}</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160; </div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;<span class="comment"> * timerConfigForSend() is used exclusively by IRsend::enableIROut()</span></div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;<span class="comment"> * Set output pin mode and disable receive interrupt if it uses the same resource</span></div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gab4f8dc26e10c0481e8859252afa4d42b">timerConfigForSend</a>(uint16_t aFrequencyKHz) {</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;    <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>();</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;<span class="preprocessor">#    if defined(IR_SEND_PIN)</span></div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;    pinMode(<a class="code" href="group__Timer.html#ga4cb394b3b749f9302940902fb05bd920">IR_SEND_PIN</a>, OUTPUT);</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;<span class="preprocessor">#    else</span></div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;    pinMode(<a class="code" href="group__Sending.html#gafba8232b747be85f72c1c4612780d5cf">IrSender</a>.<a class="code" href="classIRsend.html#a39f9782dd884b804bcf0034ab71ac202">sendPin</a>, OUTPUT);</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;<span class="preprocessor">#    endif</span></div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160; </div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;    uint32_t period = (float) F_BUS_ACTUAL / (<span class="keywordtype">float</span>) ((aFrequencyKHz) * 2000);</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    uint32_t prescale = 0;</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;    <span class="keywordflow">while</span> (period &gt; 32767) {</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;        period = period &gt;&gt; 1;</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;        <span class="keywordflow">if</span> (prescale &lt; 7)</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;            prescale++;</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    }</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;    FLEXPWM1_FCTRL0 |= FLEXPWM_FCTRL0_FLVL(8);</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;    FLEXPWM1_FSTS0 = 0x0008;</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;    FLEXPWM1_MCTRL |= FLEXPWM_MCTRL_CLDOK(8);</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;    FLEXPWM1_SM3CTRL2 = FLEXPWM_SMCTRL2_INDEP;</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;    FLEXPWM1_SM3CTRL = FLEXPWM_SMCTRL_HALF | FLEXPWM_SMCTRL_PRSC(prescale);</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;    FLEXPWM1_SM3INIT = -period;</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    FLEXPWM1_SM3VAL0 = 0;</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    FLEXPWM1_SM3VAL1 = period;</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    FLEXPWM1_SM3VAL2 = -(period / 3);</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;    FLEXPWM1_SM3VAL3 = period / 3;</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    FLEXPWM1_SM3VAL4 = 0;</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;    FLEXPWM1_SM3VAL5 = 0;</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;    FLEXPWM1_MCTRL |= FLEXPWM_MCTRL_LDOK(8) | FLEXPWM_MCTRL_RUN(8);</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;}</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;<span class="preprocessor">#  endif // defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160; </div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;<span class="comment">/**********************************************************</span></div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;<span class="comment"> * ESP8266 boards</span></div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;<span class="comment"> **********************************************************/</span></div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;<span class="preprocessor">#elif defined(ESP8266)</span></div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;<span class="preprocessor">#  if defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;<span class="preprocessor">#error &quot;No support for hardware PWM generation for ESP8266&quot;</span></div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;<span class="preprocessor">#  endif // defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160; </div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;<span class="comment">// Undefine ISR, because we register/call the plain function IRReceiveTimerInterruptHandler()</span></div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;<span class="preprocessor">#  if defined(ISR)</span></div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;<span class="preprocessor">#undef ISR</span></div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160; </div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gae0ec21c275dd13fff83445ce6cc900d7">timerEnableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    timer1_attachInterrupt(&amp;<a class="code" href="group__Receiving.html#ga770e03720a79491d7ddf347ad4b9e484">IRReceiveTimerInterruptHandler</a>); <span class="comment">// enables interrupt too</span></div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;}</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    timer1_detachInterrupt(); <span class="comment">// disables interrupt too</span></div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;}</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160; </div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga8cca92581b5452eaac5b3075227c6c56">timerConfigForReceive</a>() {</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    timer1_isr_init();</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;<span class="comment">     * TIM_DIV1 = 0,   //80MHz (80 ticks/us - 104857.588 us max)</span></div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;<span class="comment">     * TIM_DIV16 = 1,  //5MHz (5 ticks/us - 1677721.4 us max)</span></div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;<span class="comment">     * TIM_DIV256 = 3  //312.5Khz (1 tick = 3.2us - 26843542.4 us max)</span></div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;    timer1_enable(TIM_DIV16, TIM_EDGE, TIM_LOOP);</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    timer1_write((80 / 16) * <a class="code" href="IRremote_8hpp.html#a1c7eebb527483c272812530caa313d20">MICROS_PER_TICK</a>); <span class="comment">// 80 for 80 and 160! MHz clock, 16 for TIM_DIV16 above</span></div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;}</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160; </div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;<span class="comment">/**********************************************************</span></div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;<span class="comment"> * ESP32 boards - can use any pin for send PWM</span></div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;<span class="comment"> * Receive timer and send generation are independent,</span></div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;<span class="comment"> * so it is recommended to always define SEND_PWM_BY_TIMER</span></div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;<span class="comment"> **********************************************************/</span></div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;<span class="preprocessor">#elif defined(ESP32)</span></div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;<span class="preprocessor">#  if ESP_ARDUINO_VERSION &gt;= ESP_ARDUINO_VERSION_VAL(3, 0, 0)</span></div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;<span class="preprocessor">#error This library does not work with ESP32 core 3.x. Please use ESP 2.0.17 core. You are kindly invited to port and document the code to 3.x, to fix this problem!</span></div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160; </div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;<span class="comment">// Variables specific to the ESP32.</span></div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;<span class="comment">// the ledc functions behave like hardware timers for us :-), so we do not require our own soft PWM generation code.</span></div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;hw_timer_t *s50usTimer = NULL; <span class="comment">// set by timerConfigForReceive()</span></div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160; </div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;<span class="preprocessor">#  if ESP_ARDUINO_VERSION &lt; ESP_ARDUINO_VERSION_VAL(3, 0, 0) &amp;&amp;  !defined(SEND_LEDC_CHANNEL)</span></div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;<span class="preprocessor">#define SEND_LEDC_CHANNEL 0 // The channel used for PWM 0 to 7 are high speed PWM channels</span></div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160; </div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gae0ec21c275dd13fff83445ce6cc900d7">timerEnableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    timerAlarmEnable(s50usTimer);</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;}</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160; </div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;<span class="preprocessor">#  if !defined(ESP_ARDUINO_VERSION)</span></div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;<span class="preprocessor">#define ESP_ARDUINO_VERSION 0</span></div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;<span class="preprocessor">#  if !defined(ESP_ARDUINO_VERSION_VAL)</span></div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;<span class="preprocessor">#define ESP_ARDUINO_VERSION_VAL(major, minor, patch) 202</span></div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;<span class="preprocessor">#  if ESP_ARDUINO_VERSION &lt; ESP_ARDUINO_VERSION_VAL(2, 0, 2)</span></div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;    <span class="keywordflow">if</span> (s50usTimer != NULL) {</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;        timerDetachInterrupt(s50usTimer);</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;        timerEnd(s50usTimer);</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;    }</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;}</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;<span class="preprocessor">#  else</span></div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;    <span class="keywordflow">if</span> (s50usTimer != NULL) {</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;        timerAlarmDisable(s50usTimer);</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;    }</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;}</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160; </div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;<span class="comment">// Undefine ISR, because we register/call the plain function IRReceiveTimerInterruptHandler()</span></div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;<span class="preprocessor">#  if defined(ISR)</span></div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;<span class="preprocessor">#undef ISR</span></div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160; </div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;<span class="preprocessor">#  if !defined(DISABLE_CODE_FOR_RECEIVER) // &amp;IRReceiveTimerInterruptHandler is referenced, but not available</span></div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga8cca92581b5452eaac5b3075227c6c56">timerConfigForReceive</a>() {</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;    <span class="comment">// ESP32 has a proper API to setup timers, no weird chip macros needed</span></div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;    <span class="comment">// simply call the readable API versions :)</span></div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;    <span class="comment">// 3 timers, choose #1, 80 divider for microsecond precision @80MHz clock, count_up = true</span></div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;    <span class="keywordflow">if</span>(s50usTimer == NULL) {</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;        s50usTimer = timerBegin(1, 80, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;        timerAttachInterrupt(s50usTimer, &amp;<a class="code" href="group__Receiving.html#ga770e03720a79491d7ddf347ad4b9e484">IRReceiveTimerInterruptHandler</a>, <span class="keyword">false</span>); <span class="comment">// false -&gt; level interrupt, true -&gt; edge interrupt, but this is not supported :-(</span></div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;        timerAlarmWrite(s50usTimer, <a class="code" href="IRremote_8hpp.html#a1c7eebb527483c272812530caa313d20">MICROS_PER_TICK</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;    }</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;    <span class="comment">// every 50 us, autoreload = true</span></div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;}</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160; </div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;<span class="preprocessor">#  if !defined(IR_SEND_PIN)</span></div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;uint8_t sLastSendPin = 0; <span class="comment">// To detach before attach, if already attached</span></div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160; </div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;<span class="preprocessor">#  if defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gac67e6a15f31989aa182389cd4a8729c9">enableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;<span class="preprocessor">#    if ESP_ARDUINO_VERSION &lt; ESP_ARDUINO_VERSION_VAL(3, 0, 0)</span></div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    ledcWrite(SEND_LEDC_CHANNEL, (<a class="code" href="IRremote_8hpp.html#a6be706039d9083db8cb072478e0a09f8">IR_SEND_DUTY_CYCLE_PERCENT</a> * 256) / 100); <span class="comment">//  * 256 since we have 8 bit resolution</span></div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;<span class="preprocessor">#    else</span></div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    ledcWrite(<a class="code" href="group__Sending.html#gafba8232b747be85f72c1c4612780d5cf">IrSender</a>.<a class="code" href="classIRsend.html#a39f9782dd884b804bcf0034ab71ac202">sendPin</a>, (<a class="code" href="IRremote_8hpp.html#a6be706039d9083db8cb072478e0a09f8">IR_SEND_DUTY_CYCLE_PERCENT</a> * 256) / 100); <span class="comment">// New API</span></div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;<span class="preprocessor">#    endif</span></div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;}</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga352399811c67be16548d81a18e3cd337">disableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;<span class="preprocessor">#    if ESP_ARDUINO_VERSION &lt; ESP_ARDUINO_VERSION_VAL(3, 0, 0)</span></div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;    ledcWrite(SEND_LEDC_CHANNEL, 0);</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;<span class="preprocessor">#    else</span></div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;    ledcWrite(<a class="code" href="group__Sending.html#gafba8232b747be85f72c1c4612780d5cf">IrSender</a>.<a class="code" href="classIRsend.html#a39f9782dd884b804bcf0034ab71ac202">sendPin</a>, 0); <span class="comment">// New API</span></div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;<span class="preprocessor">#    endif</span></div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;}</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160; </div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;<span class="comment"> * timerConfigForSend() is used exclusively by IRsend::enableIROut() (or enableHighFrequencyIROut())</span></div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;<span class="comment"> * ledcWrite since ESP 2.0.2 does not work if pin mode is set.</span></div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gab4f8dc26e10c0481e8859252afa4d42b">timerConfigForSend</a>(uint16_t aFrequencyKHz) {</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;<span class="preprocessor">#    if ESP_ARDUINO_VERSION &lt; ESP_ARDUINO_VERSION_VAL(3, 0, 0)</span></div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;    ledcSetup(SEND_LEDC_CHANNEL, aFrequencyKHz * 1000, 8);  <span class="comment">// 8 bit PWM resolution</span></div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;<span class="preprocessor">#      if defined(IR_SEND_PIN)</span></div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;    ledcAttachPin(<a class="code" href="group__Timer.html#ga4cb394b3b749f9302940902fb05bd920">IR_SEND_PIN</a>, SEND_LEDC_CHANNEL);  <span class="comment">// attach pin to channel</span></div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;<span class="preprocessor">#      else</span></div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;    <span class="keywordflow">if</span>(sLastSendPin != 0 &amp;&amp; sLastSendPin != <a class="code" href="group__Sending.html#gafba8232b747be85f72c1c4612780d5cf">IrSender</a>.<a class="code" href="classIRsend.html#a39f9782dd884b804bcf0034ab71ac202">sendPin</a>){</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;        ledcDetachPin(<a class="code" href="group__Sending.html#gafba8232b747be85f72c1c4612780d5cf">IrSender</a>.<a class="code" href="classIRsend.html#a39f9782dd884b804bcf0034ab71ac202">sendPin</a>);  <span class="comment">// detach pin before new attaching see #1194</span></div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;    }</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;    ledcAttachPin(<a class="code" href="group__Sending.html#gafba8232b747be85f72c1c4612780d5cf">IrSender</a>.<a class="code" href="classIRsend.html#a39f9782dd884b804bcf0034ab71ac202">sendPin</a>, SEND_LEDC_CHANNEL);  <span class="comment">// attach pin to channel</span></div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;    sLastSendPin = <a class="code" href="group__Sending.html#gafba8232b747be85f72c1c4612780d5cf">IrSender</a>.<a class="code" href="classIRsend.html#a39f9782dd884b804bcf0034ab71ac202">sendPin</a>;</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;<span class="preprocessor">#      endif</span></div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;<span class="preprocessor">#    else  // New API here</span></div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;<span class="preprocessor">#      if defined(IR_SEND_PIN)</span></div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;    ledcAttach(<a class="code" href="group__Timer.html#ga4cb394b3b749f9302940902fb05bd920">IR_SEND_PIN</a>, aFrequencyKHz * 1000, 8); <span class="comment">// New API</span></div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;<span class="preprocessor">#      else</span></div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;    <span class="keywordflow">if</span>(sLastSendPin != 0 &amp;&amp; sLastSendPin != <a class="code" href="group__Sending.html#gafba8232b747be85f72c1c4612780d5cf">IrSender</a>.<a class="code" href="classIRsend.html#a39f9782dd884b804bcf0034ab71ac202">sendPin</a>){</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;        ledcDetach(<a class="code" href="group__Sending.html#gafba8232b747be85f72c1c4612780d5cf">IrSender</a>.<a class="code" href="classIRsend.html#a39f9782dd884b804bcf0034ab71ac202">sendPin</a>); <span class="comment">// detach pin before new attaching see #1194</span></div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;    }</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;    ledcAttach(<a class="code" href="group__Sending.html#gafba8232b747be85f72c1c4612780d5cf">IrSender</a>.<a class="code" href="classIRsend.html#a39f9782dd884b804bcf0034ab71ac202">sendPin</a>, aFrequencyKHz * 1000, 8); <span class="comment">// New API</span></div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    sLastSendPin = <a class="code" href="group__Sending.html#gafba8232b747be85f72c1c4612780d5cf">IrSender</a>.<a class="code" href="classIRsend.html#a39f9782dd884b804bcf0034ab71ac202">sendPin</a>;</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;<span class="preprocessor">#      endif</span></div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;<span class="preprocessor">#    endif</span></div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;}</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;<span class="preprocessor">#  endif // defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160; </div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;<span class="comment">/***************************************</span></div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;<span class="comment"> * SAMD boards like DUE and Zero</span></div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;<span class="comment"> ***************************************/</span></div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;<span class="preprocessor">#elif defined(ARDUINO_ARCH_SAMD)</span></div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;<span class="preprocessor">#  if defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;<span class="preprocessor">#error PWM generation by hardware is not yet implemented for SAMD</span></div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160; </div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;<span class="preprocessor">#  if !defined(IR_SAMD_TIMER)</span></div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;<span class="preprocessor">#    if defined(__SAMD51__)</span></div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;<span class="preprocessor">#define IR_SAMD_TIMER       TC5</span></div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;<span class="preprocessor">#define IR_SAMD_TIMER_IRQ   TC5_IRQn</span></div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;<span class="preprocessor">#    else</span></div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;<span class="comment">// SAMD21</span></div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;<span class="preprocessor">#define IR_SAMD_TIMER       TC3</span></div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;<span class="preprocessor">#define IR_SAMD_TIMER_ID    GCLK_CLKCTRL_ID_TCC2_TC3</span></div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;<span class="preprocessor">#define IR_SAMD_TIMER_IRQ   TC3_IRQn</span></div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;<span class="preprocessor">#    endif</span></div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160; </div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gae0ec21c275dd13fff83445ce6cc900d7">timerEnableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;    NVIC_EnableIRQ (IR_SAMD_TIMER_IRQ);</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;}</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;    NVIC_DisableIRQ (IR_SAMD_TIMER_IRQ); <span class="comment">// or TC5-&gt;INTENCLR.bit.MC0 = 1; or TC5-&gt;COUNT16.CTRLA.reg &amp;= ~TC_CTRLA_ENABLE;</span></div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160; </div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;}</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;<span class="comment">// Undefine ISR, because we call the plain function IRReceiveTimerInterruptHandler()</span></div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;<span class="comment">// The ISR is now TC3_Handler() or TC5_Handler() below</span></div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;<span class="preprocessor">#  if defined(ISR)</span></div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;<span class="preprocessor">#undef ISR</span></div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160; </div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga8cca92581b5452eaac5b3075227c6c56">timerConfigForReceive</a>() {</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;    TcCount16 *TC = (TcCount16*) IR_SAMD_TIMER;</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160; </div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;<span class="preprocessor">#  if defined(__SAMD51__)</span></div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;    <span class="comment">// Enable the TC5 clock, use generic clock generator 0 (F_CPU) for TC5</span></div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;    GCLK-&gt;PCHCTRL[TC5_GCLK_ID].reg = GCLK_PCHCTRL_GEN_GCLK0_Val | (1 &lt;&lt; GCLK_PCHCTRL_CHEN_Pos);</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160; </div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;    <span class="comment">// The TC should be disabled before the TC is reset in order to avoid undefined behavior.</span></div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;    TC-&gt;CTRLA.reg &amp;= ~TC_CTRLA_ENABLE; <span class="comment">// Disable the Timer</span></div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;    <span class="keywordflow">while</span> (TC-&gt;SYNCBUSY.bit.ENABLE)</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;        ; <span class="comment">// Wait for disabled</span></div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;    <span class="comment">// Reset TCx</span></div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;    TC-&gt;CTRLA.reg = TC_CTRLA_SWRST;</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;    <span class="comment">// When writing a &#39;1&#39; to the CTRLA.SWRST bit it will immediately read as &#39;1&#39;.</span></div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;    <span class="keywordflow">while</span> (TC-&gt;SYNCBUSY.bit.SWRST)</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;        ; <span class="comment">// CTRL.SWRST will be cleared by hardware when the peripheral has been reset.</span></div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160; </div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;    <span class="comment">// SAMD51 has F_CPU = 120 MHz</span></div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;    TC-&gt;CC[0].reg = ((<a class="code" href="IRremote_8hpp.html#a1c7eebb527483c272812530caa313d20">MICROS_PER_TICK</a> * (F_CPU / <a class="code" href="IRremote_8hpp.html#af33c8a218dd35ede965cf20a68a0068d">MICROS_IN_ONE_SECOND</a>)) / 16) - 1;   <span class="comment">// (375 - 1);</span></div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160; </div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;<span class="comment">     * Set timer counter mode to 16 bits, set mode as match frequency, prescaler is DIV16 =&gt; 7.5 MHz clock, start counter</span></div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;    TC-&gt;CTRLA.reg |= TC_CTRLA_MODE_COUNT16 | TC_WAVE_WAVEGEN_MFRQ | TC_CTRLA_PRESCALER_DIV16 | TC_CTRLA_ENABLE;</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;<span class="comment">//    while (TC5-&gt;COUNT16.STATUS.bit.SYNCBUSY == 1);                                // The next commands do an implicit wait :-)</span></div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;<span class="preprocessor">#  else</span></div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;    <span class="comment">// Enable GCLK and select GCLK0 (F_CPU) as clock for TC4 and TC5</span></div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;    REG_GCLK_CLKCTRL = (uint16_t)(GCLK_CLKCTRL_CLKEN | GCLK_CLKCTRL_GEN_GCLK0 | IR_SAMD_TIMER_ID);</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;    <span class="keywordflow">while</span> (GCLK-&gt;STATUS.bit.SYNCBUSY == 1)</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;        ;</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160; </div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;    <span class="comment">// The TC should be disabled before the TC is reset in order to avoid undefined behavior.</span></div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;    TC-&gt;CTRLA.reg &amp;= ~TC_CTRLA_ENABLE;</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;    <span class="comment">// When write-synchronization is ongoing for a register, any subsequent write attempts to this register will be discarded, and an error will be reported.</span></div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;    <span class="keywordflow">while</span> (TC-&gt;STATUS.bit.SYNCBUSY == 1)</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;        ; <span class="comment">// wait for sync to ensure that we can write again to COUNT16.CTRLA.reg</span></div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;    <span class="comment">// Reset TCx</span></div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;    TC-&gt;CTRLA.reg = TC_CTRLA_SWRST;</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;    <span class="comment">// When writing a 1 to the CTRLA.SWRST bit it will immediately read as 1.</span></div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;    <span class="keywordflow">while</span> (TC-&gt;CTRLA.bit.SWRST)</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;        ; <span class="comment">// CTRL.SWRST will be cleared by hardware when the peripheral has been reset.</span></div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160; </div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;    <span class="comment">// SAMD51 has F_CPU = 48 MHz</span></div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;    TC-&gt;CC[0].reg = ((<a class="code" href="IRremote_8hpp.html#a1c7eebb527483c272812530caa313d20">MICROS_PER_TICK</a> * (F_CPU / <a class="code" href="IRremote_8hpp.html#af33c8a218dd35ede965cf20a68a0068d">MICROS_IN_ONE_SECOND</a>)) / 16) - 1;   <span class="comment">// (150 - 1);</span></div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160; </div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;<span class="comment">     * Set timer counter mode to 16 bits, set mode as match frequency, prescaler is DIV16 =&gt; 3 MHz clock, start counter</span></div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;    TC-&gt;CTRLA.reg |= TC_CTRLA_MODE_COUNT16 | TC_CTRLA_WAVEGEN_MFRQ | TC_CTRLA_PRESCALER_DIV16 | TC_CTRLA_ENABLE;</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160; </div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;    <span class="comment">// Configure interrupt request</span></div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;    NVIC_DisableIRQ (IR_SAMD_TIMER_IRQ);</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;    NVIC_ClearPendingIRQ(IR_SAMD_TIMER_IRQ);</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;    NVIC_SetPriority(IR_SAMD_TIMER_IRQ, 0);</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;    NVIC_EnableIRQ(IR_SAMD_TIMER_IRQ);</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160; </div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;    <span class="comment">// Enable the compare interrupt</span></div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;    TC-&gt;INTENSET.bit.MC0 = 1;</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;}</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160; </div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;<span class="preprocessor">#  if !defined(DISABLE_CODE_FOR_RECEIVER)</span></div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;<span class="preprocessor">#    if defined(__SAMD51__)</span></div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;<span class="keywordtype">void</span> TC5_Handler(<span class="keywordtype">void</span>) {</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;    TcCount16 *TC = (TcCount16*) IR_SAMD_TIMER;</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;    <span class="comment">// Check for right interrupt bit</span></div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;    <span class="keywordflow">if</span> (TC-&gt;INTFLAG.bit.MC0 == 1) {</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;        <span class="comment">// reset bit for next turn</span></div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;        TC-&gt;INTFLAG.bit.MC0 = 1;</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;        <a class="code" href="group__Receiving.html#ga770e03720a79491d7ddf347ad4b9e484">IRReceiveTimerInterruptHandler</a>();</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;    }</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;}</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;<span class="preprocessor">#    else</span></div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;<span class="keywordtype">void</span> TC3_Handler(<span class="keywordtype">void</span>) {</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;    TcCount16 *TC = (TcCount16*) IR_SAMD_TIMER;</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;    <span class="comment">// Check for right interrupt bit</span></div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;    <span class="keywordflow">if</span> (TC-&gt;INTFLAG.bit.MC0 == 1) {</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;        <span class="comment">// reset bit for next turn</span></div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;        TC-&gt;INTFLAG.bit.MC0 = 1;</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;        <a class="code" href="group__Receiving.html#ga770e03720a79491d7ddf347ad4b9e484">IRReceiveTimerInterruptHandler</a>();</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;    }</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;}</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;<span class="preprocessor">#    endif // defined(__SAMD51__)</span></div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;<span class="preprocessor">#  endif // !defined(DISABLE_CODE_FOR_RECEIVER)</span></div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160; </div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;<span class="comment">/***************************************</span></div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;<span class="comment"> * Mbed based boards</span></div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;<span class="comment"> ***************************************/</span></div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;<span class="preprocessor">#elif defined(ARDUINO_ARCH_MBED) // Arduino Nano 33 BLE + Sparkfun Apollo3 + Nano RP2040 Connect</span></div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;<span class="preprocessor">#include &quot;mbed.h&quot;</span></div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;mbed::Ticker s50usTimer;</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160; </div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;<span class="comment">// Undefine ISR, because we register/call the plain function IRReceiveTimerInterruptHandler()</span></div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;<span class="preprocessor">#  if defined(ISR)</span></div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;<span class="preprocessor">#undef ISR</span></div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160; </div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gae0ec21c275dd13fff83445ce6cc900d7">timerEnableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;    s50usTimer.attach(<a class="code" href="group__Receiving.html#ga770e03720a79491d7ddf347ad4b9e484">IRReceiveTimerInterruptHandler</a>, std::chrono::microseconds(<a class="code" href="IRremote_8hpp.html#a1c7eebb527483c272812530caa313d20">MICROS_PER_TICK</a>));</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;}</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;    s50usTimer.detach();</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;}</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160; </div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga8cca92581b5452eaac5b3075227c6c56">timerConfigForReceive</a>() {</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;    s50usTimer.attach(<a class="code" href="group__Receiving.html#ga770e03720a79491d7ddf347ad4b9e484">IRReceiveTimerInterruptHandler</a>, std::chrono::microseconds(<a class="code" href="IRremote_8hpp.html#a1c7eebb527483c272812530caa313d20">MICROS_PER_TICK</a>));</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;}</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160; </div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;<span class="preprocessor">#  if defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;<span class="preprocessor">#include &quot;pins_arduino.h&quot;</span> <span class="comment">// for digitalPinToPinName()</span></div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160; </div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;<span class="preprocessor">#    if defined(IR_SEND_PIN)</span></div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;mbed::PwmOut sPwmOutForSendPWM(digitalPinToPinName(<a class="code" href="group__Timer.html#ga4cb394b3b749f9302940902fb05bd920">IR_SEND_PIN</a>));</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;<span class="preprocessor">#    else</span></div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;mbed::PwmOut sPwmOutForSendPWM(digitalPinToPinName(<a class="code" href="group__Sending.html#gafba8232b747be85f72c1c4612780d5cf">IrSender</a>.<a class="code" href="classIRsend.html#a39f9782dd884b804bcf0034ab71ac202">sendPin</a>));</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;<span class="preprocessor">#    endif</span></div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;uint8_t sIROutPuseWidth;</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160; </div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gac67e6a15f31989aa182389cd4a8729c9">enableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;    sPwmOutForSendPWM.pulsewidth_us(sIROutPuseWidth);</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;}</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;<span class="comment">//void enableSendPWMByTimer() {    sPwmOutForSendPWM.resume(); sPwmOutForSendPWM.pulsewidth_us(sIROutPuseWidth);}</span></div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;<span class="comment">//void disableSendPWMByTimer() {   sPwmOutForSendPWM.suspend();} // this kills pulsewidth_us value and does not set output level to LOW</span></div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160; </div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga352399811c67be16548d81a18e3cd337">disableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;    sPwmOutForSendPWM.pulsewidth_us(0); <span class="comment">// this also sets output level to LOW :-)</span></div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;}</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160; </div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;<span class="comment"> * timerConfigForSend() is used exclusively by IRsend::enableIROut()</span></div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;<span class="comment"> * Set output pin mode and disable receive interrupt if it uses the same resource</span></div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gab4f8dc26e10c0481e8859252afa4d42b">timerConfigForSend</a>(uint16_t aFrequencyKHz) {</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;    sPwmOutForSendPWM.period_us(1000 / aFrequencyKHz);  <span class="comment">// 26.315 for 38 kHz</span></div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;    sIROutPuseWidth = (1000 * <a class="code" href="IRremote_8hpp.html#a6be706039d9083db8cb072478e0a09f8">IR_SEND_DUTY_CYCLE_PERCENT</a>) / (aFrequencyKHz * 100);</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;}</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;<span class="preprocessor">#  endif // defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160; </div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;<span class="comment">/*************************************************************************************************************************************</span></div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;<span class="comment"> * RP2040 based boards for pico core</span></div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;<span class="comment"> * https://github.com/earlephilhower/arduino-pico</span></div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;<span class="comment"> * https://github.com/earlephilhower/arduino-pico/releases/download/global/package_rp2040_index.json</span></div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;<span class="comment"> * Can use any pin for PWM, no timer restrictions</span></div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;<span class="comment"> *************************************************************************************************************************************/</span></div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;<span class="preprocessor">#elif defined(ARDUINO_ARCH_RP2040) // Raspberry Pi Pico, Adafruit Feather RP2040, etc.</span></div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;<span class="preprocessor">#include &quot;pico/time.h&quot;</span></div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160; </div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;repeating_timer_t s50usTimer;</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160; </div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;<span class="comment">// Undefine ISR, because we register/call the plain function IRReceiveTimerInterruptHandler()</span></div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;<span class="preprocessor">#  if defined(ISR)</span></div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;<span class="preprocessor">#undef ISR</span></div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160; </div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;<span class="comment">// The timer callback has a parameter and a return value</span></div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;<span class="keywordtype">bool</span> IRTimerInterruptHandlerHelper(repeating_timer_t*) {</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;    <a class="code" href="group__Receiving.html#ga770e03720a79491d7ddf347ad4b9e484">IRReceiveTimerInterruptHandler</a>();</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;}</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160; </div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gae0ec21c275dd13fff83445ce6cc900d7">timerEnableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;    add_repeating_timer_us(-(<a class="code" href="IRremote_8hpp.html#a1c7eebb527483c272812530caa313d20">MICROS_PER_TICK</a>), IRTimerInterruptHandlerHelper, NULL, &amp;s50usTimer);</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;}</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;    cancel_repeating_timer(&amp;s50usTimer);</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;}</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160; </div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga8cca92581b5452eaac5b3075227c6c56">timerConfigForReceive</a>() {</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;    <span class="comment">// no need for initializing timer at setup()</span></div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;}</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160; </div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;<span class="preprocessor">#  if defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;<span class="preprocessor">#include &quot;hardware/pwm.h&quot;</span></div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160; </div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;uint sSliceNumberForSendPWM;</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;uint sChannelNumberForSendPWM;</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;uint sIROutPuseWidth;</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160; </div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;<span class="comment"> * If we just disable the PWM, the counter stops and the output stays at the state is currently has</span></div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gac67e6a15f31989aa182389cd4a8729c9">enableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;    pwm_set_counter(sSliceNumberForSendPWM, 0);</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;    pwm_set_chan_level(sSliceNumberForSendPWM, sChannelNumberForSendPWM, sIROutPuseWidth);</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;}</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga352399811c67be16548d81a18e3cd337">disableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;    pwm_set_chan_level(sSliceNumberForSendPWM, sChannelNumberForSendPWM, 0); <span class="comment">// this sets output also to LOW</span></div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;}</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160; </div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;<span class="comment"> * timerConfigForSend() is used exclusively by IRsend::enableIROut()</span></div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;<span class="comment"> * Set output pin mode and disable receive interrupt if it uses the same resource</span></div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gab4f8dc26e10c0481e8859252afa4d42b">timerConfigForSend</a>(uint16_t aFrequencyKHz) {</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;<span class="preprocessor">#    if defined(IR_SEND_PIN)</span></div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;    gpio_set_function(<a class="code" href="group__Timer.html#ga4cb394b3b749f9302940902fb05bd920">IR_SEND_PIN</a>, GPIO_FUNC_PWM);</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;    <span class="comment">// Find out which PWM slice is connected to IR_SEND_PIN</span></div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;    sSliceNumberForSendPWM = pwm_gpio_to_slice_num(<a class="code" href="group__Timer.html#ga4cb394b3b749f9302940902fb05bd920">IR_SEND_PIN</a>);</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;    sChannelNumberForSendPWM = pwm_gpio_to_channel(<a class="code" href="group__Timer.html#ga4cb394b3b749f9302940902fb05bd920">IR_SEND_PIN</a>);</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;<span class="preprocessor">#    else</span></div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;    gpio_set_function(<a class="code" href="group__Sending.html#gafba8232b747be85f72c1c4612780d5cf">IrSender</a>.<a class="code" href="classIRsend.html#a39f9782dd884b804bcf0034ab71ac202">sendPin</a>, GPIO_FUNC_PWM);</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;    <span class="comment">// Find out which PWM slice is connected to IR_SEND_PIN</span></div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;    sSliceNumberForSendPWM = pwm_gpio_to_slice_num(<a class="code" href="group__Sending.html#gafba8232b747be85f72c1c4612780d5cf">IrSender</a>.<a class="code" href="classIRsend.html#a39f9782dd884b804bcf0034ab71ac202">sendPin</a>);</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;    sChannelNumberForSendPWM = pwm_gpio_to_channel(<a class="code" href="group__Sending.html#gafba8232b747be85f72c1c4612780d5cf">IrSender</a>.<a class="code" href="classIRsend.html#a39f9782dd884b804bcf0034ab71ac202">sendPin</a>);</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;<span class="preprocessor">#    endif</span></div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;    uint16_t tPWMWrapValue = (clock_get_hz(clk_sys)) / (aFrequencyKHz * 1000); <span class="comment">// 3289.473 for 38 kHz @125 MHz clock. We have a 16 bit counter and use system clock (125 MHz)</span></div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160; </div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;    pwm_config tPWMConfig = pwm_get_default_config();</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;    pwm_config_set_wrap(&amp;tPWMConfig, tPWMWrapValue - 1);</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;    pwm_init(sSliceNumberForSendPWM, &amp;tPWMConfig, <span class="keyword">false</span>); <span class="comment">// we do not want to send now</span></div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;    sIROutPuseWidth = ((tPWMWrapValue * <a class="code" href="IRremote_8hpp.html#a6be706039d9083db8cb072478e0a09f8">IR_SEND_DUTY_CYCLE_PERCENT</a>) / 100) - 1; <span class="comment">// 985.84 for 38 kHz</span></div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;    pwm_set_chan_level(sSliceNumberForSendPWM, sChannelNumberForSendPWM, 0);</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;    pwm_set_enabled(sSliceNumberForSendPWM, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;}</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;<span class="preprocessor">#  endif // defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160; </div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;<span class="comment">/***************************************</span></div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;<span class="comment"> * NRF5 boards like the BBC:Micro</span></div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;<span class="comment"> ***************************************/</span></div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;<span class="preprocessor">#elif defined(NRF5) || defined(ARDUINO_ARCH_NRF52840) || defined(ARDUINO_ARCH_NRF52)</span></div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;<span class="preprocessor">#  if defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;<span class="preprocessor">#error PWM generation by hardware not implemented for NRF5</span></div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160; </div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gae0ec21c275dd13fff83445ce6cc900d7">timerEnableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;    NVIC_EnableIRQ (TIMER2_IRQn);</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;}</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;    NVIC_DisableIRQ (TIMER2_IRQn);</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;}</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160; </div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;<span class="comment">// Undefine ISR, because we call the plain function IRReceiveTimerInterruptHandler()</span></div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;<span class="preprocessor">#  if defined(ISR)</span></div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;<span class="preprocessor">#undef ISR</span></div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160; </div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga8cca92581b5452eaac5b3075227c6c56">timerConfigForReceive</a>() {</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;    NRF_TIMER2-&gt;MODE = TIMER_MODE_MODE_Timer;              <span class="comment">// Set the timer in Timer Mode</span></div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;    NRF_TIMER2-&gt;TASKS_CLEAR = 1;              <span class="comment">// clear the task first to be usable for later</span></div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;    NRF_TIMER2-&gt;PRESCALER = 4;              <span class="comment">// f TIMER = 16 MHz / (2 ^ PRESCALER ) : 4 -&gt; 1 MHz, 1 uS</span></div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;    NRF_TIMER2-&gt;BITMODE = TIMER_BITMODE_BITMODE_16Bit;              <span class="comment">//Set counter to 16 bit resolution</span></div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;    NRF_TIMER2-&gt;CC[0] = <a class="code" href="IRremote_8hpp.html#a1c7eebb527483c272812530caa313d20">MICROS_PER_TICK</a>;              <span class="comment">//Set value for TIMER2 compare register 0, to trigger every 50 uS</span></div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;    NRF_TIMER2-&gt;CC[1] = 0;              <span class="comment">//Set value for TIMER2 compare register 1</span></div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160; </div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;    <span class="comment">// Enable interrupt on Timer 2, for CC[0] compare match events</span></div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;    NRF_TIMER2-&gt;INTENSET = (TIMER_INTENSET_COMPARE0_Enabled &lt;&lt; TIMER_INTENSET_COMPARE0_Pos);</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;    NRF_TIMER2-&gt;TASKS_START = 1;              <span class="comment">// Start TIMER2</span></div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160; </div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;    <span class="comment">// timerAttachInterrupt(timer, &amp;IRTimerInterruptHandler, 1);</span></div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;}</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160; </div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;<span class="preprocessor">#if !defined(DISABLE_CODE_FOR_RECEIVER)</span></div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160; </div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> {</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;<span class="keywordtype">void</span> TIMER2_IRQHandler(<span class="keywordtype">void</span>) {</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;    <span class="comment">// Interrupt Service Routine - Fires every 50uS</span></div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;    <span class="keywordflow">if</span> ((NRF_TIMER2-&gt;EVENTS_COMPARE[0] != 0) &amp;&amp; ((NRF_TIMER2-&gt;INTENSET &amp; TIMER_INTENSET_COMPARE0_Msk) != 0)) {</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;        NRF_TIMER2-&gt;EVENTS_COMPARE[0] = 0;          <span class="comment">//Clear compare register 0 event</span></div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;        <a class="code" href="group__Receiving.html#ga770e03720a79491d7ddf347ad4b9e484">IRReceiveTimerInterruptHandler</a>();          <span class="comment">// call the IR-receive function</span></div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;        NRF_TIMER2-&gt;CC[0] += 50;</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;    }</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;}</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;}</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160; </div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;<span class="comment">/**********************************************************************************************************************</span></div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;<span class="comment"> * BluePill in 2 flavors see https://samuelpinches.com.au/3d-printer/cutting-through-some-confusion-on-stm32-and-arduino/</span></div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;<span class="comment"> * Recommended original Arduino_STM32 by Roger Clark.</span></div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;<span class="comment"> * http://dan.drown.org/stm32duino/package_STM32duino_index.json</span></div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;<span class="comment"> * STM32F1 architecture for &quot;Generic STM32F103C series&quot; from &quot;STM32F1 Boards (Arduino_STM32)&quot; of Arduino Board manager</span></div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;<span class="comment"> **********************************************************************************************************************/</span></div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;<span class="preprocessor">#elif defined(__STM32F1__) || defined(ARDUINO_ARCH_STM32F1)</span></div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;<span class="preprocessor">#include &lt;HardwareTimer.h&gt;</span> <span class="comment">// 4 timers and 4. timer (4.channel) is used for tone()</span></div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;<span class="preprocessor">#  if defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;<span class="preprocessor">#error PWM generation by hardware not implemented for STM32</span></div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160; </div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;<span class="comment"> * Use timer 3 as IR timer.</span></div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;<span class="comment"> * Timer 3 blocks PA6, PA7, PB0, PB1, so if you require one of them as tone() or Servo output, you must choose another timer.</span></div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;HardwareTimer s50usTimer(3);</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160; </div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gae0ec21c275dd13fff83445ce6cc900d7">timerEnableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;    s50usTimer.resume();</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;}</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;    s50usTimer.pause();</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;}</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160; </div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;<span class="comment">// Undefine ISR, because we register/call the plain function IRReceiveTimerInterruptHandler()</span></div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;<span class="preprocessor">#  if defined(ISR)</span></div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;<span class="preprocessor">#undef ISR</span></div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160; </div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga8cca92581b5452eaac5b3075227c6c56">timerConfigForReceive</a>() {</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;    s50usTimer.setMode(TIMER_CH1, TIMER_OUTPUT_COMPARE);</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;    s50usTimer.setPrescaleFactor(1);</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;    s50usTimer.setOverflow((F_CPU / <a class="code" href="IRremote_8hpp.html#af33c8a218dd35ede965cf20a68a0068d">MICROS_IN_ONE_SECOND</a>) * <a class="code" href="IRremote_8hpp.html#a1c7eebb527483c272812530caa313d20">MICROS_PER_TICK</a>);</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;    s50usTimer.attachInterrupt(TIMER_CH1, <a class="code" href="group__Receiving.html#ga770e03720a79491d7ddf347ad4b9e484">IRReceiveTimerInterruptHandler</a>);</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;    s50usTimer.refresh();</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;}</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160; </div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;<span class="comment">/**********************************************************************************************************************</span></div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;<span class="comment"> * STM32duino by ST Microsystems.</span></div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;<span class="comment"> * https://github.com/stm32duino/Arduino_Core_STM32</span></div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;<span class="comment"> * https://github.com/stm32duino/BoardManagerFiles/raw/master/STM32/package_stm_index.json</span></div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;<span class="comment"> * stm32 architecture for &quot;Generic STM32F1 series&quot; from &quot;STM32 Boards (selected from submenu)&quot; of Arduino Board manager</span></div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;<span class="comment"> **********************************************************************************************************************/</span></div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;<span class="preprocessor">#elif defined(STM32F1xx) || defined(ARDUINO_ARCH_STM32)</span></div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;<span class="preprocessor">#include &lt;HardwareTimer.h&gt;</span> <span class="comment">// 4 timers and 3. timer is used for tone(), 2. for Servo</span></div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;<span class="preprocessor">#  if defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;<span class="preprocessor">#error PWM generation by hardware not implemented for STM32</span></div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160; </div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;<span class="comment"> * Use timer 4 as IR timer.</span></div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;<span class="comment"> * Timer 4 blocks PB6, PB7, PB8, PB9, so if you need one them as tone() or Servo output, you must choose another timer.</span></div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;<span class="preprocessor">#  if defined(TIM4)</span></div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;HardwareTimer s50usTimer(TIM4);</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;<span class="preprocessor">#  else</span></div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;HardwareTimer s50usTimer(TIM2);</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160; </div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gae0ec21c275dd13fff83445ce6cc900d7">timerEnableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;    s50usTimer.resume();</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;}</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;    s50usTimer.pause();</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;}</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160; </div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;<span class="comment">// Undefine ISR, because we register/call the plain function IRReceiveTimerInterruptHandler()</span></div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;<span class="preprocessor">#  if defined(ISR)</span></div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;<span class="preprocessor">#undef ISR</span></div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160; </div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga8cca92581b5452eaac5b3075227c6c56">timerConfigForReceive</a>() {</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;    s50usTimer.setOverflow(<a class="code" href="IRremote_8hpp.html#a1c7eebb527483c272812530caa313d20">MICROS_PER_TICK</a>, MICROSEC_FORMAT); <span class="comment">// 50 uS</span></div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;    s50usTimer.attachInterrupt(<a class="code" href="group__Receiving.html#ga770e03720a79491d7ddf347ad4b9e484">IRReceiveTimerInterruptHandler</a>);</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;    s50usTimer.resume();</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;}</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160; </div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;<span class="comment">/***************************************</span></div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;<span class="comment"> * Particle special IntervalTimer</span></div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;<span class="comment"> * !!!UNTESTED!!!</span></div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;<span class="comment"> ***************************************/</span></div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;<span class="preprocessor">#elif defined(PARTICLE)</span></div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;<span class="preprocessor">#  ifndef __INTERVALTIMER_H__</span></div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;<span class="preprocessor">#include &quot;SparkIntervalTimer.h&quot;</span> <span class="comment">// SparkIntervalTimer.h is required if PARTICLE is defined.</span></div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160; </div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;<span class="keyword">extern</span> IntervalTimer timer;</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;<span class="keyword">extern</span> <span class="keywordtype">int</span> ir_out_kHz;</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160; </div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gae0ec21c275dd13fff83445ce6cc900d7">timerEnableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;    timer.begin(<a class="code" href="group__Receiving.html#ga770e03720a79491d7ddf347ad4b9e484">IRReceiveTimerInterruptHandler</a>, <a class="code" href="IRremote_8hpp.html#a1c7eebb527483c272812530caa313d20">MICROS_PER_TICK</a>, uSec);</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;}</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>() {</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;    timer.end();</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;}</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160; </div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;<span class="comment">// Undefine ISR, because we register/call the plain function IRReceiveTimerInterruptHandler()</span></div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;<span class="preprocessor">#  if defined(ISR)</span></div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;<span class="preprocessor">#undef ISR</span></div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160; </div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga8cca92581b5452eaac5b3075227c6c56">timerConfigForReceive</a>() {</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;}</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160; </div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;<span class="preprocessor">#  if defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;<span class="preprocessor">#    if defined(IR_SEND_PIN)</span></div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gac67e6a15f31989aa182389cd4a8729c9">enableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;    analogWrite(<a class="code" href="group__Timer.html#ga4cb394b3b749f9302940902fb05bd920">IR_SEND_PIN</a>, ((256L * 100) / <a class="code" href="IRremote_8hpp.html#a6be706039d9083db8cb072478e0a09f8">IR_SEND_DUTY_CYCLE_PERCENT</a>)), ir_out_kHz*1000);</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;}</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga352399811c67be16548d81a18e3cd337">disableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;    analogWrite(<a class="code" href="group__Timer.html#ga4cb394b3b749f9302940902fb05bd920">IR_SEND_PIN</a>, 0, ir_out_kHz*1000);</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;}</div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;<span class="preprocessor">#    else</span></div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gac67e6a15f31989aa182389cd4a8729c9">enableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;    analogWrite(<a class="code" href="group__Sending.html#gafba8232b747be85f72c1c4612780d5cf">IrSender</a>.<a class="code" href="classIRsend.html#a39f9782dd884b804bcf0034ab71ac202">sendPin</a>, ((256L * 100) / <a class="code" href="IRremote_8hpp.html#a6be706039d9083db8cb072478e0a09f8">IR_SEND_DUTY_CYCLE_PERCENT</a>), ir_out_kHz * 1000);</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;}</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga352399811c67be16548d81a18e3cd337">disableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;    analogWrite(<a class="code" href="group__Sending.html#gafba8232b747be85f72c1c4612780d5cf">IrSender</a>.<a class="code" href="classIRsend.html#a39f9782dd884b804bcf0034ab71ac202">sendPin</a>, 0, ir_out_kHz * 1000);</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;}</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;<span class="preprocessor">#    endif</span></div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160; </div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160; </div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;<span class="comment"> * timerConfigForSend() is used exclusively by IRsend::enableIROut()</span></div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;<span class="comment"> * Set output pin mode and disable receive interrupt if it uses the same resource</span></div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gab4f8dc26e10c0481e8859252afa4d42b">timerConfigForSend</a>(uint16_t aFrequencyKHz) {</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;    <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>();</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;<span class="preprocessor">#    if defined(IR_SEND_PIN)</span></div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;    pinMode(<a class="code" href="group__Timer.html#ga4cb394b3b749f9302940902fb05bd920">IR_SEND_PIN</a>, OUTPUT);</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;<span class="preprocessor">#    else</span></div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;    pinMode(<a class="code" href="group__Sending.html#gafba8232b747be85f72c1c4612780d5cf">IrSender</a>.<a class="code" href="classIRsend.html#a39f9782dd884b804bcf0034ab71ac202">sendPin</a>, OUTPUT);</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;<span class="preprocessor">#    endif</span></div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;    ir_out_kHz = aFrequencyKHz;</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;}</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;<span class="preprocessor">#  endif // defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160; </div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;<span class="comment">/***************************************</span></div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;<span class="comment"> * Unknown CPU board</span></div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;<span class="comment"> ***************************************/</span></div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;<span class="preprocessor">#error Internal code configuration error, no timer functions implemented for this CPU / board</span></div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;<span class="comment"> * Dummy definitions to avoid more irritating compile errors</span></div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160; </div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gae0ec21c275dd13fff83445ce6cc900d7">timerEnableReceiveInterrupt</a>() {};</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>() {};</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160; </div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;<span class="preprocessor">#  if defined(ISR)</span></div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;<span class="preprocessor">#undef ISR</span></div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;<span class="preprocessor">#  endif</span></div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;<span class="preprocessor">#define ISR() void notImplemented(void)</span></div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160; </div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga8cca92581b5452eaac5b3075227c6c56">timerConfigForReceive</a>() {</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;}</div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160; </div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;<span class="preprocessor">#  if defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gac67e6a15f31989aa182389cd4a8729c9">enableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;}</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#ga352399811c67be16548d81a18e3cd337">disableSendPWMByTimer</a>() {</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;}</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160; </div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__Timer.html#gab4f8dc26e10c0481e8859252afa4d42b">timerConfigForSend</a>(uint16_t aFrequencyKHz) {</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;    <a class="code" href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a>();</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;<span class="preprocessor">#    if defined(IR_SEND_PIN)</span></div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;    pinMode(<a class="code" href="group__Timer.html#ga4cb394b3b749f9302940902fb05bd920">IR_SEND_PIN</a>, OUTPUT);</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;<span class="preprocessor">#    else</span></div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;    pinMode(<a class="code" href="group__Sending.html#gafba8232b747be85f72c1c4612780d5cf">IrSender</a>.<a class="code" href="classIRsend.html#a39f9782dd884b804bcf0034ab71ac202">sendPin</a>, OUTPUT);</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;<span class="preprocessor">#    endif</span></div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;    (void) aFrequencyKHz;</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;}</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;<span class="preprocessor">#  endif // defined(SEND_PWM_BY_TIMER)</span></div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160; </div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;<span class="preprocessor">#endif // defined(DOXYGEN / CPU_TYPES)</span></div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160; </div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;<span class="preprocessor">#endif // _IR_TIMER_HPP</span></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="agroup__Timer_html_ga8cca92581b5452eaac5b3075227c6c56"><div class="ttname"><a href="group__Timer.html#ga8cca92581b5452eaac5b3075227c6c56">timerConfigForReceive</a></div><div class="ttdeci">void timerConfigForReceive()</div><div class="ttdoc">Configures the timer to be able to generate the receive sample interrupt, which consumes a small amou...</div><div class="ttdef"><b>Definition:</b> <a href="IRTimer_8hpp_source.html#l00103">IRTimer.hpp:103</a></div></div>
<div class="ttc" id="aIRremote_8hpp_html_a1c7eebb527483c272812530caa313d20"><div class="ttname"><a href="IRremote_8hpp.html#a1c7eebb527483c272812530caa313d20">MICROS_PER_TICK</a></div><div class="ttdeci">#define MICROS_PER_TICK</div><div class="ttdoc">microseconds per clock interrupt tick</div><div class="ttdef"><b>Definition:</b> <a href="IRremote_8hpp_source.html#l00251">IRremote.hpp:250</a></div></div>
<div class="ttc" id="aclassIRsend_html_a39f9782dd884b804bcf0034ab71ac202"><div class="ttname"><a href="classIRsend.html#a39f9782dd884b804bcf0034ab71ac202">IRsend::sendPin</a></div><div class="ttdeci">uint8_t sendPin</div><div class="ttdef"><b>Definition:</b> <a href="IRremoteInt_8h_source.html#l00645">IRremoteInt.h:645</a></div></div>
<div class="ttc" id="agroup__Timer_html_ga4cb394b3b749f9302940902fb05bd920"><div class="ttname"><a href="group__Timer.html#ga4cb394b3b749f9302940902fb05bd920">IR_SEND_PIN</a></div><div class="ttdeci">#define IR_SEND_PIN</div><div class="ttdoc">Hardware / timer dependent pin number for sending IR if SEND_PWM_BY_TIMER is defined.</div><div class="ttdef"><b>Definition:</b> <a href="IRTimer_8hpp_source.html#l00096">IRTimer.hpp:95</a></div></div>
<div class="ttc" id="agroup__Timer_html_ga0b0e97d0a44ceb967a83b44aa88c6bd2"><div class="ttname"><a href="group__Timer.html#ga0b0e97d0a44ceb967a83b44aa88c6bd2">timerDisableReceiveInterrupt</a></div><div class="ttdeci">void timerDisableReceiveInterrupt()</div><div class="ttdoc">Disables the receive sample timer interrupt.</div><div class="ttdef"><b>Definition:</b> <a href="IRTimer_8hpp_source.html#l00115">IRTimer.hpp:115</a></div></div>
<div class="ttc" id="agroup__Timer_html_gab4f8dc26e10c0481e8859252afa4d42b"><div class="ttname"><a href="group__Timer.html#gab4f8dc26e10c0481e8859252afa4d42b">timerConfigForSend</a></div><div class="ttdeci">void timerConfigForSend(uint16_t aFrequencyKHz)</div><div class="ttdoc">IF PWM should be generated not by software, but by a timer, this function sets output pin mode,...</div><div class="ttdef"><b>Definition:</b> <a href="IRTimer_8hpp_source.html#l00127">IRTimer.hpp:127</a></div></div>
<div class="ttc" id="agroup__Receiving_html_ga770e03720a79491d7ddf347ad4b9e484"><div class="ttname"><a href="group__Receiving.html#ga770e03720a79491d7ddf347ad4b9e484">IRReceiveTimerInterruptHandler</a></div><div class="ttdeci">void IRReceiveTimerInterruptHandler()</div><div class="ttdef"><b>Definition:</b> <a href="IRReceive_8hpp_source.html#l00122">IRReceive.hpp:122</a></div></div>
<div class="ttc" id="aIRremote_8hpp_html_af33c8a218dd35ede965cf20a68a0068d"><div class="ttname"><a href="IRremote_8hpp.html#af33c8a218dd35ede965cf20a68a0068d">MICROS_IN_ONE_SECOND</a></div><div class="ttdeci">#define MICROS_IN_ONE_SECOND</div><div class="ttdef"><b>Definition:</b> <a href="IRremote_8hpp_source.html#l00255">IRremote.hpp:254</a></div></div>
<div class="ttc" id="agroup__Timer_html_ga41e88e0b7edea76b3c77643ca7a3468f"><div class="ttname"><a href="group__Timer.html#ga41e88e0b7edea76b3c77643ca7a3468f">timerResetInterruptPending</a></div><div class="ttdeci">void timerResetInterruptPending()</div></div>
<div class="ttc" id="agroup__Timer_html_gae0ec21c275dd13fff83445ce6cc900d7"><div class="ttname"><a href="group__Timer.html#gae0ec21c275dd13fff83445ce6cc900d7">timerEnableReceiveInterrupt</a></div><div class="ttdeci">void timerEnableReceiveInterrupt()</div><div class="ttdoc">Enables the receive sample timer interrupt, which consumes a small amount of CPU every 50 us.</div><div class="ttdef"><b>Definition:</b> <a href="IRTimer_8hpp_source.html#l00108">IRTimer.hpp:108</a></div></div>
<div class="ttc" id="agroup__Timer_html_gac67e6a15f31989aa182389cd4a8729c9"><div class="ttname"><a href="group__Timer.html#gac67e6a15f31989aa182389cd4a8729c9">enableSendPWMByTimer</a></div><div class="ttdeci">void enableSendPWMByTimer()</div><div class="ttdoc">Enables output of the PWM signal of the timer at the timer pin.</div><div class="ttdef"><b>Definition:</b> <a href="IRTimer_8hpp_source.html#l00133">IRTimer.hpp:133</a></div></div>
<div class="ttc" id="agroup__Sending_html_gafba8232b747be85f72c1c4612780d5cf"><div class="ttname"><a href="group__Sending.html#gafba8232b747be85f72c1c4612780d5cf">IrSender</a></div><div class="ttdeci">IRsend IrSender</div><div class="ttdef"><b>Definition:</b> <a href="IRSend_8hpp_source.html#l00065">IRSend.hpp:65</a></div></div>
<div class="ttc" id="aIRremote_8hpp_html_a6be706039d9083db8cb072478e0a09f8"><div class="ttname"><a href="IRremote_8hpp.html#a6be706039d9083db8cb072478e0a09f8">IR_SEND_DUTY_CYCLE_PERCENT</a></div><div class="ttdeci">#define IR_SEND_DUTY_CYCLE_PERCENT</div><div class="ttdoc">Duty cycle in percent for sent signals.</div><div class="ttdef"><b>Definition:</b> <a href="IRremote_8hpp_source.html#l00244">IRremote.hpp:243</a></div></div>
<div class="ttc" id="agroup__Timer_html_ga352399811c67be16548d81a18e3cd337"><div class="ttname"><a href="group__Timer.html#ga352399811c67be16548d81a18e3cd337">disableSendPWMByTimer</a></div><div class="ttdeci">void disableSendPWMByTimer()</div><div class="ttdoc">Disables output of the PWM signal of the timer at the timer pin and set it to inactive.</div><div class="ttdef"><b>Definition:</b> <a href="IRTimer_8hpp_source.html#l00138">IRTimer.hpp:138</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_d49b597d86ed44de6eb8a459f0ed40df.html">private</a></li><li class="navelem"><a class="el" href="IRTimer_8hpp.html">IRTimer.hpp</a></li>
    <li class="footer">Generated on Thu Jul 11 2024 21:32:02 for IRremote by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.18 </li>
  </ul>
</div>
</body>
</html>
